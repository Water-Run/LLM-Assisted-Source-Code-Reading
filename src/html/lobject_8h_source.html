<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: lobject.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('lobject_8h_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">lobject.h</div></div>
</div><!--header-->
<div class="contents">
<a href="lobject_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">** 文件概要说明</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">**</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">** 文件名: lobject.h</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">** 版本: $Id: lobject.h $</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">** 作用: Lua对象的类型定义</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">** 版权信息: 见lua.h</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">**</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">** 这个头文件是Lua虚拟机的核心文件之一,定义了Lua中所有基本数据类型的内部表示。</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">**</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">** 主要内容包括:</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">** 1. TValue结构 - Lua中所有值的统一表示(带标签的值)</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">** 2. 各种基本类型的定义和操作宏:</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">**    - nil (包括多种变体:标准nil、空槽、缺失键等)</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">**    - boolean (true/false)</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">**    - number (整数和浮点数)</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">**    - string (短字符串和长字符串)</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment">**    - userdata (轻量和完全userdata)</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="comment">**    - function (Lua闭包、C闭包、轻量C函数)</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="comment">**    - table (哈希表)</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="comment">**    - thread (协程)</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment">** 3. 垃圾回收相关的结构和标记</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="comment">** 4. 栈值(StackValue)的定义</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="comment">** 5. 各种辅助宏用于类型检查、值设置和获取</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="comment">**</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="comment">** 核心设计思想:</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="comment">** - 使用&quot;带标签的值&quot;(Tagged Value)设计,每个值包含实际数据和类型标签</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="comment">** - 类型标签使用位运算编码类型信息和变体信息</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">** - 通过宏提供类型安全的访问接口</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">*/</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#ifndef lobject_h</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#define lobject_h</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &lt;stdarg.h&gt;</span> <span class="comment">// 标准库头文件,提供可变参数列表支持(va_list, va_start等)</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="llimits_8h.html">llimits.h</a>&quot;</span> <span class="comment">// Lua的限制和平台相关定义(如整数类型、内存限制等)</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &quot;<a class="code" href="lua_8h.html">lua.h</a>&quot;</span>     <span class="comment">// Lua的公共API定义</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="comment">/*</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="comment">** 额外的可回收对象类型</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="comment">**</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="comment">** 这些是Lua内部使用的类型,不直接暴露给用户</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">** LUA_NUMTYPES是在lua.h中定义的基本类型数量</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">*/</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">/* upvalues - 上值,用于实现闭包的捕获变量 */</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="lobject_8h.html#a3175b6b959953f781a14a9291d9e22b6">   52</a></span><span class="preprocessor">#define LUA_TUPVAL LUA_NUMTYPES</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment">/* function prototypes - 函数原型,存储函数的字节码和元信息 */</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa2a683d9e42dac5846eefa108297cbf0">   54</a></span><span class="preprocessor">#define LUA_TPROTO (LUA_NUMTYPES + 1)</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">/* removed keys in tables - 表中被删除的键,用于垃圾回收优化 */</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="lobject_8h.html#a8626e895a2b49a9b945c96281d854fb5">   56</a></span><span class="preprocessor">#define LUA_TDEADKEY (LUA_NUMTYPES + 2)</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="comment">/*</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="comment">** 所有可能类型的总数(包括LUA_TNONE但不包括DEADKEY)</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="comment">**</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="comment">** LUA_TNONE通常值为-1,表示&quot;无类型&quot;</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="comment">** DEADKEY是内部使用的特殊标记,不计入总数</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="comment">*/</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno"><a class="line" href="lobject_8h.html#a19bae920c9c442143f021d1c4301b8cb">   66</a></span><span class="preprocessor">#define LUA_TOTALTYPES (LUA_TPROTO + 2)</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">/*</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="comment">** 标签值(Tagged Values)的标签位使用说明</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span><span class="comment">**</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span><span class="comment">** 每个TValue都有一个tt_字段(类型标签),是一个字节(8位):</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="comment">** - 位 0-3: 实际类型标签(LUA_T*常量,如LUA_TNIL, LUA_TNUMBER等)</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="comment">** - 位 4-5: 变体位(用于区分同一类型的不同变体,如整数vs浮点数)</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="comment">** - 位 6:   是否可回收标记(1表示需要垃圾回收)</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="comment">** - 位 7:   保留</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="comment">**</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span><span class="comment">** 这种设计允许在一个字节内编码类型、变体和GC信息</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="comment">*/</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span><span class="comment">/*</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="comment">** 为类型添加变体位</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment">** 参数: t - 基础类型, v - 变体值(0-3)</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="comment">** 返回: 带变体的类型标签</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="comment">*/</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6f70bdfe97f0e09461cfd2aadd6c0602">   87</a></span><span class="preprocessor">#define makevariant(t, v) ((t) | ((v) &lt;&lt; 4))</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="comment">/*</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span><span class="comment">** 所有Lua值的联合体</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span><span class="comment">**</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span><span class="comment">** Value联合体可以存储任何Lua值的实际数据</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span><span class="comment">** 使用联合体可以节省内存,因为一个值同时只能是一种类型</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00097" data-start="{" data-end="};">
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno"><a class="line" href="unionValue.html">   97</a></span><span class="keyword">typedef</span> <span class="keyword">union </span><a class="code hl_union" href="unionValue.html">Value</a></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>{</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno"><a class="line" href="unionValue.html#a1809643a2deb85a2e8d690b8e1488481">   99</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structGCObject.html">GCObject</a> *<a class="code hl_variable" href="unionValue.html#a1809643a2deb85a2e8d690b8e1488481">gc</a>; <span class="comment">/* 可回收对象(字符串、表、函数等) */</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno"><a class="line" href="unionValue.html#aa001f39a25c7d85a27cbdbab2d386ccd">  100</a></span>  <span class="keywordtype">void</span> *<a class="code hl_variable" href="unionValue.html#aa001f39a25c7d85a27cbdbab2d386ccd">p</a>;             <span class="comment">/* 轻量用户数据(light userdata) - 不需要GC的C指针 */</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno"><a class="line" href="unionValue.html#acc94eaa63b3acf650541fcd09025f2ad">  101</a></span>  <a class="code hl_typedef" href="lua_8h.html#a878b7e392e78661a374cf1c3073029b9">lua_CFunction</a> <a class="code hl_variable" href="unionValue.html#acc94eaa63b3acf650541fcd09025f2ad">f</a>;     <span class="comment">/* 轻量C函数 - 直接存储函数指针 */</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno"><a class="line" href="unionValue.html#a0d6f6bd1f2576b712e95aaffa0f87bab">  102</a></span>  <a class="code hl_typedef" href="lua_8h.html#a362144baa0cfb14dc38fd21438053d73">lua_Integer</a> <a class="code hl_variable" href="unionValue.html#a0d6f6bd1f2576b712e95aaffa0f87bab">i</a>;       <span class="comment">/* 整数(通常是64位整数) */</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno"><a class="line" href="unionValue.html#ae8663f45c016d5fbf827cb308b2f3df8">  103</a></span>  <a class="code hl_typedef" href="lua_8h.html#af0a6ed3b852d680769cfc410a0672172">lua_Number</a> <a class="code hl_variable" href="unionValue.html#ae8663f45c016d5fbf827cb308b2f3df8">n</a>;        <span class="comment">/* 浮点数(通常是double) */</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>  <span class="comment">/* 未使用,但可避免未初始化值的警告 */</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno"><a class="line" href="unionValue.html#aa6fc4345b43257a82c278a07adcf59dc">  105</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="unionValue.html#aa6fc4345b43257a82c278a07adcf59dc">ub</a>; <span class="comment">/* 无符号字节 */</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="lobject_8h.html#a33d0ee7f37b6b7cf753e159ea8ae8a52">  106</a></span>} <a class="code hl_union" href="unionValue.html">Value</a>;</div>
</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span><span class="comment">/*</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="comment">** 带标签的值(Tagged Values)</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="comment">**</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="comment">** 这是Lua中值的基本表示:一个实际值加上其类型标签</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span><span class="comment">**</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span><span class="comment">** TValue是整个Lua虚拟机最核心的数据结构:</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span><span class="comment">** - value_: 存储实际数据的Value联合体</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="comment">** - tt_: 类型标签字节,编码类型、变体和GC信息</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span><span class="comment">**</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="comment">** 这种设计的优点:</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span><span class="comment">** 1. 统一表示所有类型</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">** 2. 类型检查快速(只需检查一个字节)</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment">** 3. 内存效率高(联合体只占用最大成员的空间)</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment">*/</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span> </div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="comment">/* TValue的字段定义宏 */</span></div>
<div class="foldopen" id="foldopen00126" data-start="" data-end="">
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno"><a class="line" href="lobject_8h.html#a33c298ced3df4f041dd86a19a6c0dae2">  126</a></span><span class="preprocessor">#define TValuefields \</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="preprocessor">  Value value_;      \</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="preprocessor">  lu_byte tt_</span></div>
</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment">/* TValue结构体 */</span></div>
<div class="foldopen" id="foldopen00131" data-start="{" data-end="};">
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno"><a class="line" href="structTValue.html">  131</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structTValue.html">TValue</a></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>{</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno"><a class="line" href="structTValue.html#ab8256d9daa6c5ba0d03dcfcf997357f7">  133</a></span>  <a class="code hl_variable" href="structTValue.html#ab8256d9daa6c5ba0d03dcfcf997357f7">TValuefields</a>; <span class="comment">/* 展开为: Value value_; lu_byte tt_; */</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno"><a class="line" href="lobject_8h.html#a1f32c523a9a46759690a7acc24eedc19">  134</a></span>} <a class="code hl_struct" href="structTValue.html">TValue</a>;</div>
</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment">/* 获取TValue的value_字段 */</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa57d3f96227213dee2530ccf9c0bd055">  137</a></span><span class="preprocessor">#define val_(o) ((o)-&gt;value_)</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="comment">/* 获取原始值(无类型检查) */</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno"><a class="line" href="lobject_8h.html#a8a47bf030949aef5df2fd844415e2501">  139</a></span><span class="preprocessor">#define valraw(o) (val_(o))</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span><span class="comment">/* 获取TValue的原始类型标签(包含所有位信息) */</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno"><a class="line" href="lobject_8h.html#a4e4078cdfa594d60186ec4369b582acf">  142</a></span><span class="preprocessor">#define rawtt(o) ((o)-&gt;tt_)</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span> </div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="comment">/*</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="comment">** 无变体的类型标签(仅保留位0-3)</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span><span class="comment">** 用于获取基础类型,忽略变体信息</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="comment">** 0x0F = 0b00001111,保留低4位</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span><span class="comment">*/</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno"><a class="line" href="lobject_8h.html#a40d12e88a0d8249d226109e0d6d70dd6">  149</a></span><span class="preprocessor">#define novariant(t) ((t) &amp; 0x0F)</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span><span class="comment">/*</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span><span class="comment">** 带变体的类型标签(位0-5)</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="comment">** 0x3F = 0b00111111,保留低6位(类型+变体)</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span><span class="comment">*/</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno"><a class="line" href="lobject_8h.html#a97f74541c5efde62e7dc88e8cebd75d9">  155</a></span><span class="preprocessor">#define withvariant(t) ((t) &amp; 0x3F)</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span><span class="comment">/* 获取TValue的完整类型标签(类型+变体) */</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="lobject_8h.html#a01db083f8bc8b2eb51a45c0ba9967043">  157</a></span><span class="preprocessor">#define ttypetag(o) withvariant(rawtt(o))</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span><span class="comment">/* 获取TValue的基础类型(无变体) */</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno"><a class="line" href="lobject_8h.html#acd205ab396b96fba48e1f758c17a2cf3">  160</a></span><span class="preprocessor">#define ttype(o) (novariant(rawtt(o)))</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span><span class="comment">** 类型测试宏</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span><span class="comment">*/</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span><span class="comment">/* 检查标签是否完全匹配(包括变体) */</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno"><a class="line" href="lobject_8h.html#af8389211babbb622ff1ac83021f2fd76">  167</a></span><span class="preprocessor">#define checktag(o, t) (rawtt(o) == (t))</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="comment">/* 检查基础类型是否匹配(忽略变体) */</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="lobject_8h.html#a591e9cc1db9d9f210702bdbf2ba10d02">  169</a></span><span class="preprocessor">#define checktype(o, t) (ttype(o) == (t))</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="comment">** 内部测试宏</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">*/</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span> </div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span><span class="comment">/*</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span><span class="comment">** 检查可回收对象的标签是否与原始值匹配</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span><span class="comment">** 用于调试,确保GC对象的类型信息一致</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span><span class="comment">*/</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno"><a class="line" href="lobject_8h.html#a08f554017b8314e2dfc0dfd05b1d8167">  180</a></span><span class="preprocessor">#define righttt(obj) (ttypetag(obj) == gcvalue(obj)-&gt;tt)</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span><span class="comment">/*</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span><span class="comment">** 检查值的&quot;活性&quot;(liveness)</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="comment">**</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span><span class="comment">** 任何被程序操作的值要么是:</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span><span class="comment">** 1. 不可回收的(如数字、布尔值)</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">** 2. 可回收对象且标签正确且未死亡</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="comment">**</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span><span class="comment">** &#39;L == NULL&#39;选项允许在L不可用时使用此宏</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="comment">**</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="comment">** 这个宏在调试版本中用于运行时检查,确保不会访问已被GC回收的对象</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00193" data-start="" data-end="">
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno"><a class="line" href="lobject_8h.html#aeec8842aa72396b2719685ad7e131f37">  193</a></span><span class="preprocessor">#define checkliveness(L, obj)                     \</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="preprocessor">  ((void)L, lua_longassert(!iscollectable(obj) || \</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="preprocessor">                           (righttt(obj) &amp;&amp; (L == NULL || !isdead(G(L), gcvalue(obj))))))</span></div>
</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="comment">** 值设置宏</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="comment">*/</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="comment">/* 设置值的类型标签 */</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno"><a class="line" href="lobject_8h.html#a60983604f73f556a06f84026b29ed840">  203</a></span><span class="preprocessor">#define settt_(o, t) ((o)-&gt;tt_ = (t))</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="comment">/*</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="comment">** 主要的值复制宏(从obj2复制到obj1)</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="comment">**</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="comment">** 步骤:</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="comment">** 1. 创建临时指针避免宏参数副作用</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="comment">** 2. 复制value_字段(实际数据)</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="comment">** 3. 复制tt_字段(类型标签)</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span><span class="comment">** 4. 检查活性(调试版本)</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="comment">** 5. 断言不是非标准nil</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00215" data-start="" data-end="">
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno"><a class="line" href="lobject_8h.html#acf2af15f3d5cceca8e8870f96634bc2d">  215</a></span><span class="preprocessor">#define setobj(L, obj1, obj2)         \</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span><span class="preprocessor">  {                                   \</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span><span class="preprocessor">    TValue *io1 = (obj1);             \</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span><span class="preprocessor">    const TValue *io2 = (obj2);       \</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span><span class="preprocessor">    io1-&gt;value_ = io2-&gt;value_;        \</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span><span class="preprocessor">    settt_(io1, io2-&gt;tt_);            \</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="preprocessor">    checkliveness(L, io1);            \</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span><span class="preprocessor">    lua_assert(!isnonstrictnil(io1)); \</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="comment">/*</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="comment">** 不同类型的赋值操作</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="comment">**</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span><span class="comment">** 根据源和目标的不同,使用不同的赋值宏</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="comment">** (目前它们大多相同,但将来可能不同,例如写屏障的不同处理)</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span><span class="comment">*/</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span><span class="comment">/* 从栈到栈 - s2v将StackValue转换为TValue */</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno"><a class="line" href="lobject_8h.html#af9258d87e8f082be8a2adb731d90f1a5">  235</a></span><span class="preprocessor">#define setobjs2s(L, o1, o2) setobj(L, s2v(o1), s2v(o2))</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span><span class="comment">/* 到栈(不是从同一个栈) */</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno"><a class="line" href="lobject_8h.html#add70d29b431f66a1dee29a0cb286de6e">  237</a></span><span class="preprocessor">#define setobj2s(L, o1, o2) setobj(L, s2v(o1), o2)</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span><span class="comment">/* 从表到同一个表 */</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno"><a class="line" href="lobject_8h.html#a0b6916971c4766bf58d942bf7a426c80">  239</a></span><span class="preprocessor">#define setobjt2t setobj</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span><span class="comment">/* 到新对象 */</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno"><a class="line" href="lobject_8h.html#ad6d8d3d900cff1b02c3b269eabccccf9">  241</a></span><span class="preprocessor">#define setobj2n setobj</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span><span class="comment">/* 到表 */</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno"><a class="line" href="lobject_8h.html#adefdd17d98f1f5734ee296395e1805d4">  243</a></span><span class="preprocessor">#define setobj2t setobj</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="comment">/*</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="comment">** Lua栈中的条目</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="comment">**</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="comment">** StackValue是栈槽的表示,它是一个联合体:</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="comment">** 1. val: 普通的TValue</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span><span class="comment">** 2. tbclist: 用于&quot;to-be-closed&quot;变量的链表节点</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span><span class="comment">**</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="comment">** &quot;to-be-closed&quot;变量是Lua 5.4引入的特性,允许在作用域结束时</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="comment">** 自动调用清理函数(类似于其他语言的defer或RAII)</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span><span class="comment">**</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="comment">** delta字段用于链接到下一个tbc变量。由于delta是unsigned short,</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span><span class="comment">** 如果距离太大,会使用虚拟条目(delta==0)</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00260" data-start="{" data-end="};">
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno"><a class="line" href="unionStackValue.html">  260</a></span><span class="keyword">typedef</span> <span class="keyword">union </span><a class="code hl_union" href="unionStackValue.html">StackValue</a></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>{</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno"><a class="line" href="unionStackValue.html#a8427f32076f2a9ad8db716da1deeb468">  262</a></span>  <a class="code hl_struct" href="structTValue.html">TValue</a> <a class="code hl_variable" href="unionStackValue.html#a8427f32076f2a9ad8db716da1deeb468">val</a>; <span class="comment">/* 栈上的普通值 */</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>  <span class="keyword">struct</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>  {</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno"><a class="line" href="unionStackValue.html#a26033019ebf5144b31ae1c442c539cd4">  265</a></span>    <a class="code hl_variable" href="unionStackValue.html#a26033019ebf5144b31ae1c442c539cd4">TValuefields</a>;         <span class="comment">/* 和TValue相同的字段 */</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno"><a class="line" href="unionStackValue.html#a7771cd1552c09ee6ed38b626b2159c14">  266</a></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_variable" href="unionStackValue.html#a7771cd1552c09ee6ed38b626b2159c14">delta</a>; <span class="comment">/* 到链表中下一个tbc变量的距离 */</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno"><a class="line" href="unionStackValue.html#a9a0057a5ab930ec0bb2ad624f6c5e4ca">  267</a></span>  } <a class="code hl_variable" href="unionStackValue.html#a9a0057a5ab930ec0bb2ad624f6c5e4ca">tbclist</a>;</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno"><a class="line" href="lobject_8h.html#a7e5934136714a2f3d01cf4515d5258a0">  268</a></span>} <a class="code hl_union" href="unionStackValue.html">StackValue</a>;</div>
</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span><span class="comment">/*</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="comment">** 栈元素索引</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span><span class="comment">** StkId是指向栈槽的指针,用于索引和操作栈上的值</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span><span class="comment">*/</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno"><a class="line" href="lobject_8h.html#a75170ac0f54a6beb06b8a7f9db47d073">  274</a></span><span class="keyword">typedef</span> <a class="code hl_union" href="unionStackValue.html">StackValue</a> *<a class="code hl_typedef" href="lobject_8h.html#a75170ac0f54a6beb06b8a7f9db47d073">StkId</a>;</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span><span class="comment">/*</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span><span class="comment">** 栈重分配时的指针处理</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span><span class="comment">**</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="comment">** 当栈需要扩容时,所有指向栈的指针都会失效</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span><span class="comment">** StkIdRel允许在重分配期间将指针转换为偏移量,重分配后再转回指针</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span><span class="comment">**</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span><span class="comment">** 这是一个联合体:</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span><span class="comment">** - p: 实际指针(正常使用)</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span><span class="comment">** - offset: 偏移量(重分配期间使用)</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00288" data-start="{" data-end="};">
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno"><a class="line" href="unionStkIdRel.html">  288</a></span><span class="keyword">typedef</span> <span class="keyword">union</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>{</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno"><a class="line" href="unionStkIdRel.html#a217d7edba31898cdfe8fdd91df893d26">  290</a></span>  <a class="code hl_typedef" href="lobject_8h.html#a75170ac0f54a6beb06b8a7f9db47d073">StkId</a> <a class="code hl_variable" href="unionStkIdRel.html#a217d7edba31898cdfe8fdd91df893d26">p</a>;          <span class="comment">/* 实际指针 */</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno"><a class="line" href="unionStkIdRel.html#aa5b9278d862af81303c5ce9f9b62943b">  291</a></span>  ptrdiff_t <a class="code hl_variable" href="unionStkIdRel.html#aa5b9278d862af81303c5ce9f9b62943b">offset</a>; <span class="comment">/* 栈重分配时使用的偏移量 */</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>} <a class="code hl_union" href="unionStkIdRel.html">StkIdRel</a>;</div>
</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="comment">/*</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="comment">** 将StackValue转换为TValue</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="comment">** 因为StackValue的第一个成员是val(TValue),所以取其地址即可</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span><span class="comment">*/</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="lobject_8h.html#a8c21cbb67def90b23342840cd08a5cfd">  298</a></span><span class="preprocessor">#define s2v(o) (&amp;(o)-&gt;val)</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="comment">/*</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="comment">** Nil类型</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span><span class="comment">**</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span><span class="comment">** Lua 5.4引入了多种nil变体,用于不同的内部目的:</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span><span class="comment">** 1. LUA_VNIL: 标准的nil值</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span><span class="comment">** 2. LUA_VEMPTY: 空槽(表中未使用的位置)</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span><span class="comment">** 3. LUA_VABSTKEY: 表中不存在的键</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span><span class="comment">** 4. LUA_VNOTABLE: 快速get访问非表时的信号</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span><span class="comment">**</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span><span class="comment">** 这些变体在语义上都等同于nil,但在内部实现中有不同用途</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span><span class="comment">*/</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span><span class="comment">/* 标准nil */</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="lobject_8h.html#aac7a0aeb62c96ba16c7638e707bfaac0">  315</a></span><span class="preprocessor">#define LUA_VNIL makevariant(LUA_TNIL, 0)</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span> </div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment">/* 空槽(可能与包含nil的槽不同) */</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno"><a class="line" href="lobject_8h.html#abc8b34ab48ffd99b6d7a48e8e4f269e2">  318</a></span><span class="preprocessor">#define LUA_VEMPTY makevariant(LUA_TNIL, 1)</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span><span class="comment">/* 表访问中键不存在时返回的值(缺失键) */</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno"><a class="line" href="lobject_8h.html#acbec62756a4a34ca07969e71ac30f7f1">  321</a></span><span class="preprocessor">#define LUA_VABSTKEY makevariant(LUA_TNIL, 2)</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span> </div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="comment">/* 用于表示快速get正在访问非表对象的特殊变体 */</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno"><a class="line" href="lobject_8h.html#a7b4eeb42a08d7483d09f2f5a6248ff21">  324</a></span><span class="preprocessor">#define LUA_VNOTABLE makevariant(LUA_TNIL, 3)</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="comment">/*</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span><span class="comment">** 测试任何种类的nil</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span><span class="comment">** checktype忽略变体位,所以匹配所有nil变体</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span><span class="comment">*/</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno"><a class="line" href="lobject_8h.html#a39af019fafa202841da3bf7c427bf090">  330</a></span><span class="preprocessor">#define ttisnil(v) checktype((v), LUA_TNIL)</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="comment">/*</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span><span class="comment">** 测试表访问结果的宏</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="comment">**</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span><span class="comment">** 形式上,应该区分LUA_VEMPTY/LUA_VABSTKEY/LUA_VNOTABLE和其他标签</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span><span class="comment">** 但由于当前nil等价于LUA_VEMPTY,简单测试是否为nil即可</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span><span class="comment">*/</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno"><a class="line" href="lobject_8h.html#aec4fc2bddf98a2fc76c443e0653aedf3">  338</a></span><span class="preprocessor">#define tagisempty(tag) (novariant(tag) == LUA_TNIL)</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="comment">/* 测试标准nil */</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno"><a class="line" href="lobject_8h.html#afae62ae42d03ff2600208b109bad8070">  341</a></span><span class="preprocessor">#define ttisstrictnil(o) checktag((o), LUA_VNIL)</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="comment">/* 将对象设置为nil */</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno"><a class="line" href="lobject_8h.html#ad9034def7bbc1965ec3d714d84620b07">  344</a></span><span class="preprocessor">#define setnilvalue(obj) settt_(obj, LUA_VNIL)</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span><span class="comment">/* 测试是否为缺失键 */</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno"><a class="line" href="lobject_8h.html#abb0534795c360c0ac007d3729758f908">  347</a></span><span class="preprocessor">#define isabstkey(v) checktag((v), LUA_VABSTKEY)</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="comment">/*</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span><span class="comment">** 测试非标准nil的宏(仅用于断言)</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span><span class="comment">** 用于调试,检测意外的nil变体</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span><span class="comment">*/</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno"><a class="line" href="lobject_8h.html#a792b40c39dcc3d6b158e202919a61197">  353</a></span><span class="preprocessor">#define isnonstrictnil(v) (ttisnil(v) &amp;&amp; !ttisstrictnil(v))</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span> </div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span><span class="comment">/*</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span><span class="comment">** 默认情况下,任何种类的nil都被视为空</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span><span class="comment">** (在任何定义中,与缺失键关联的值也必须被接受为空)</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><span class="comment">*/</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno"><a class="line" href="lobject_8h.html#a5345ae49ed16dfecdfef95ec5399b000">  359</a></span><span class="preprocessor">#define isempty(v) ttisnil(v)</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span> </div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span><span class="comment">/*</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span><span class="comment">** 缺失键的常量定义</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span><span class="comment">** {NULL}, LUA_VABSTKEY 初始化一个TValue为缺失键</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span><span class="comment">*/</span></div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno"><a class="line" href="lobject_8h.html#a003630137c8fd4d1378bee8017c4fb92">  365</a></span><span class="preprocessor">#define ABSTKEYCONSTANT {NULL}, LUA_VABSTKEY</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span> </div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span><span class="comment">/* 将条目标记为空 */</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno"><a class="line" href="lobject_8h.html#a1504584244b6d1260c52a41cab9306d0">  368</a></span><span class="preprocessor">#define setempty(v) settt_(v, LUA_VEMPTY)</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span><span class="comment">** 布尔值</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span><span class="comment">**</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="comment">** 布尔类型有两个变体:false和true</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span><span class="comment">** 使用变体位区分,而不是在value_中存储0/1</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span><span class="comment">*/</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="comment">/* false变体 */</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno"><a class="line" href="lobject_8h.html#a95236d400066ed64a37c72d3dada7e9d">  379</a></span><span class="preprocessor">#define LUA_VFALSE makevariant(LUA_TBOOLEAN, 0)</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span><span class="comment">/* true变体 */</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno"><a class="line" href="lobject_8h.html#aed66cd95aa3f518c947b5bd9e17bab47">  381</a></span><span class="preprocessor">#define LUA_VTRUE makevariant(LUA_TBOOLEAN, 1)</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span><span class="comment">/* 测试是否为布尔类型 */</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno"><a class="line" href="lobject_8h.html#a44a87a5873bd05973d6e3a4747175c06">  384</a></span><span class="preprocessor">#define ttisboolean(o) checktype((o), LUA_TBOOLEAN)</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span><span class="comment">/* 测试是否为false */</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno"><a class="line" href="lobject_8h.html#aebb0fc4ab25fdfc7d01e834cc24b6048">  386</a></span><span class="preprocessor">#define ttisfalse(o) checktag((o), LUA_VFALSE)</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span><span class="comment">/* 测试是否为true */</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno"><a class="line" href="lobject_8h.html#a31a5a1c03da9886f462929d023ec00f8">  388</a></span><span class="preprocessor">#define ttistrue(o) checktag((o), LUA_VTRUE)</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span><span class="comment">/*</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="comment">** 测试值在条件语句中是否为假</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">** 在Lua中,只有false和nil为假</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="comment">*/</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno"><a class="line" href="lobject_8h.html#a188e1a95c8c6d547a13431a6e1edd5b3">  394</a></span><span class="preprocessor">#define l_isfalse(o) (ttisfalse(o) || ttisnil(o))</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="comment">/*</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span><span class="comment">** 测试标签是否表示假值</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="comment">** 用于优化,直接从标签判断而不需要完整的TValue</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="comment">*/</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno"><a class="line" href="lobject_8h.html#a902f21e6ff8ffb8468240fed504cfa79">  399</a></span><span class="preprocessor">#define tagisfalse(t) ((t) == LUA_VFALSE || novariant(t) == LUA_TNIL)</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span> </div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="comment">/* 设置为false */</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno"><a class="line" href="lobject_8h.html#ad0259526a10884432dd2e7ea10b90e0f">  402</a></span><span class="preprocessor">#define setbfvalue(obj) settt_(obj, LUA_VFALSE)</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="comment">/* 设置为true */</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno"><a class="line" href="lobject_8h.html#a1b86e0dccf6b92c4c89d47af26e3a8e3">  404</a></span><span class="preprocessor">#define setbtvalue(obj) settt_(obj, LUA_VTRUE)</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="comment">** 线程(协程)</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span><span class="comment">**</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="comment">** Lua的协程在内部称为&quot;线程&quot;(thread)</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span><span class="comment">** 每个协程有自己的栈和执行状态</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="comment">*/</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span><span class="comment">/* 线程类型标签(可回收) */</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno"><a class="line" href="lobject_8h.html#ad224258ccc4e8f79f148d54d32ddbd00">  415</a></span><span class="preprocessor">#define LUA_VTHREAD makevariant(LUA_TTHREAD, 0)</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span> </div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span><span class="comment">/* 测试是否为线程,ctb添加可回收标记 */</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno"><a class="line" href="lobject_8h.html#a5ae8a42aa33c44ef3c98fcda8b7ab4c5">  418</a></span><span class="preprocessor">#define ttisthread(o) checktag((o), ctb(LUA_VTHREAD))</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span> </div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span><span class="comment">/*</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="comment">** 获取线程值</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span><span class="comment">** check_exp进行类型检查,gco2th将GCObject转换为lua_State</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span><span class="comment">*/</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno"><a class="line" href="lobject_8h.html#a516f32427f1c43ee187ce4c0db042959">  424</a></span><span class="preprocessor">#define thvalue(o) check_exp(ttisthread(o), gco2th(val_(o).gc))</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span><span class="comment">/*</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span><span class="comment">** 设置线程值</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span><span class="comment">** obj2gco将lua_State转换为GCObject</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span><span class="comment">** ctb添加可回收标记</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00431" data-start="" data-end="">
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno"><a class="line" href="lobject_8h.html#a9c2bad449e8e998bb9d937642923a225">  431</a></span><span class="preprocessor">#define setthvalue(L, obj, x)     \</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span><span class="preprocessor">  {                               \</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span><span class="preprocessor">    TValue *io = (obj);           \</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span><span class="preprocessor">    lua_State *x_ = (x);          \</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span><span class="preprocessor">    val_(io).gc = obj2gco(x_);    \</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span><span class="preprocessor">    settt_(io, ctb(LUA_VTHREAD)); \</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span><span class="preprocessor">    checkliveness(L, io);         \</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span><span class="comment">/* 设置栈上的线程值 */</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno"><a class="line" href="lobject_8h.html#a538e049061af97a32cc2e59ff979c409">  441</a></span><span class="preprocessor">#define setthvalue2s(L, o, t) setthvalue(L, s2v(o), t)</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span><span class="comment">** 可回收对象</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span><span class="comment">**</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span><span class="comment">** 所有需要垃圾回收的对象都有一个公共头部</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="comment">** 这允许GC遍历所有对象而不需要知道具体类型</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="comment">*/</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span> </div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span><span class="comment">/*</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span><span class="comment">** 所有可回收对象的公共头部(宏形式,用于包含在其他对象中)</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span><span class="comment">**</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span><span class="comment">** next: 指向下一个GC对象的指针,用于形成GC链表</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="comment">** tt: 类型标签(与TValue中的tt_相同)</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="comment">** marked: GC标记字节,用于三色标记算法</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00458" data-start="" data-end="">
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno"><a class="line" href="lobject_8h.html#a5ee24faa024428a3c176895fe9925031">  458</a></span><span class="preprocessor">#define CommonHeader     \</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span><span class="preprocessor">  struct GCObject *next; \</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="preprocessor">  lu_byte tt;            \</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="preprocessor">  lu_byte marked</span></div>
</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span> </div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span><span class="comment">/*</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span><span class="comment">** 所有可回收对象的公共类型</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="comment">** 这是一个基类型,实际对象会在此基础上添加更多字段</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00467" data-start="{" data-end="};">
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno"><a class="line" href="structGCObject.html">  467</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structGCObject.html">GCObject</a></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>{</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno"><a class="line" href="structGCObject.html#af27f3b17495ada2a250831a5424ed971">  469</a></span>  <a class="code hl_variable" href="structGCObject.html#af27f3b17495ada2a250831a5424ed971">CommonHeader</a>;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno"><a class="line" href="lobject_8h.html#a695cc6eaef4f2d539a5fe6e3582a2847">  470</a></span>} <a class="code hl_struct" href="structGCObject.html">GCObject</a>;</div>
</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span> </div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="comment">/*</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="comment">** 可回收类型的位标记</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span><span class="comment">** 第6位设为1表示此类型需要垃圾回收</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="comment">*/</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6301e5933254618c0434a55a500b2282">  476</a></span><span class="preprocessor">#define BIT_ISCOLLECTABLE (1 &lt;&lt; 6)</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span> </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="comment">/* 测试对象是否可回收 */</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno"><a class="line" href="lobject_8h.html#aaabdb414706e6a904461e39967557185">  479</a></span><span class="preprocessor">#define iscollectable(o) (rawtt(o) &amp; BIT_ISCOLLECTABLE)</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span><span class="comment">/*</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span><span class="comment">** 标记类型为可回收</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span><span class="comment">** ctb = &quot;collectable tag bit&quot;</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="comment">*/</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno"><a class="line" href="lobject_8h.html#a4a1902cdda7b02eb01135585230c38f0">  485</a></span><span class="preprocessor">#define ctb(t) ((t) | BIT_ISCOLLECTABLE)</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="comment">/* 获取GC对象指针(带类型检查) */</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno"><a class="line" href="lobject_8h.html#a05cdf6070135f10ad37e1048a730b634">  488</a></span><span class="preprocessor">#define gcvalue(o) check_exp(iscollectable(o), val_(o).gc)</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span> </div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span><span class="comment">/* 获取原始GC对象指针(无类型检查) */</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno"><a class="line" href="lobject_8h.html#a719248356281fe83215c94961ad9226f">  491</a></span><span class="preprocessor">#define gcvalueraw(v) ((v).gc)</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span><span class="comment">/*</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span><span class="comment">** 设置GC对象值</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="comment">** 自动从GCObject的tt字段获取类型并添加可回收标记</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00497" data-start="" data-end="">
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno"><a class="line" href="lobject_8h.html#a977fe2a01691b55cdd5eabefb4114434">  497</a></span><span class="preprocessor">#define setgcovalue(L, obj, x) \</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="preprocessor">  {                            \</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="preprocessor">    TValue *io = (obj);        \</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span><span class="preprocessor">    GCObject *i_g = (x);       \</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span><span class="preprocessor">    val_(io).gc = i_g;         \</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="preprocessor">    settt_(io, ctb(i_g-&gt;tt));  \</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span><span class="comment">** 数字</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span><span class="comment">**</span></div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="comment">** Lua 5.3+支持两种数字类型:</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span><span class="comment">** 1. 整数(通常是64位有符号整数)</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span><span class="comment">** 2. 浮点数(通常是double)</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span><span class="comment">**</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="comment">** 使用变体位区分这两种数字类型</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span><span class="comment">*/</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span><span class="comment">/* 数字类型的变体标签 */</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno"><a class="line" href="lobject_8h.html#a69aa5cae89d634d458e0da4957257745">  517</a></span><span class="preprocessor">#define LUA_VNUMINT makevariant(LUA_TNUMBER, 0) </span><span class="comment">/* 整数 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno"><a class="line" href="lobject_8h.html#a19aaaf978586be9032b63b7a8807631a">  518</a></span><span class="preprocessor">#define LUA_VNUMFLT makevariant(LUA_TNUMBER, 1) </span><span class="comment">/* 浮点数 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span><span class="comment">/* 测试是否为数字(整数或浮点数) */</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno"><a class="line" href="lobject_8h.html#a7a1392f89b1f29ed3b1afa37a22d0be2">  521</a></span><span class="preprocessor">#define ttisnumber(o) checktype((o), LUA_TNUMBER)</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span><span class="comment">/* 测试是否为浮点数 */</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno"><a class="line" href="lobject_8h.html#ac1338b5ac67cadf27489f5ae7e939c29">  523</a></span><span class="preprocessor">#define ttisfloat(o) checktag((o), LUA_VNUMFLT)</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="comment">/* 测试是否为整数 */</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno"><a class="line" href="lobject_8h.html#abade243295a9140f7b86838fbb049054">  525</a></span><span class="preprocessor">#define ttisinteger(o) checktag((o), LUA_VNUMINT)</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span> </div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="comment">/*</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">** 获取数字值(统一返回浮点数)</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span><span class="comment">** 如果是整数,使用cast_num转换为浮点数</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00531" data-start="" data-end="">
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno"><a class="line" href="lobject_8h.html#a690ab618235691bb5a82610f07dd8684">  531</a></span><span class="preprocessor">#define nvalue(o) check_exp(ttisnumber(o), \</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span><span class="preprocessor">                            (ttisinteger(o) ? cast_num(ivalue(o)) : fltvalue(o)))</span></div>
</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="comment">/* 获取浮点数值 */</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno"><a class="line" href="lobject_8h.html#a7d7d6b08f40350c9e7364e9cb984d744">  534</a></span><span class="preprocessor">#define fltvalue(o) check_exp(ttisfloat(o), val_(o).n)</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="comment">/* 获取整数值 */</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno"><a class="line" href="lobject_8h.html#af1a59636db050b842a791cd19086d925">  536</a></span><span class="preprocessor">#define ivalue(o) check_exp(ttisinteger(o), val_(o).i)</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="comment">/* 获取原始浮点数(无类型检查) */</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno"><a class="line" href="lobject_8h.html#a7410757b6ced9fdf3cba7cc7e18cc8e6">  539</a></span><span class="preprocessor">#define fltvalueraw(v) ((v).n)</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span><span class="comment">/* 获取原始整数(无类型检查) */</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno"><a class="line" href="lobject_8h.html#a570028d77ace5fea06c305e11921dccc">  541</a></span><span class="preprocessor">#define ivalueraw(v) ((v).i)</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span> </div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span><span class="comment">/* 设置浮点数值 */</span></div>
<div class="foldopen" id="foldopen00544" data-start="" data-end="">
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno"><a class="line" href="lobject_8h.html#ae357382324a8220a3cf77607752de887">  544</a></span><span class="preprocessor">#define setfltvalue(obj, x)  \</span></div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="preprocessor">  {                          \</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span><span class="preprocessor">    TValue *io = (obj);      \</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span><span class="preprocessor">    val_(io).n = (x);        \</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span><span class="preprocessor">    settt_(io, LUA_VNUMFLT); \</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span> </div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span><span class="comment">/*</span></div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="comment">** 改变浮点数值(假设已经是浮点数)</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span><span class="comment">** 用于优化,避免重新设置类型标签</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00555" data-start="" data-end="">
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno"><a class="line" href="lobject_8h.html#afb905ab8008c82b24755df25012408f2">  555</a></span><span class="preprocessor">#define chgfltvalue(obj, x)    \</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span><span class="preprocessor">  {                            \</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span><span class="preprocessor">    TValue *io = (obj);        \</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span><span class="preprocessor">    lua_assert(ttisfloat(io)); \</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span><span class="preprocessor">    val_(io).n = (x);          \</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span> </div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="comment">/* 设置整数值 */</span></div>
<div class="foldopen" id="foldopen00563" data-start="" data-end="">
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno"><a class="line" href="lobject_8h.html#af9dd109ba186841ab26efb2d62baf4f6">  563</a></span><span class="preprocessor">#define setivalue(obj, x)    \</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span><span class="preprocessor">  {                          \</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span><span class="preprocessor">    TValue *io = (obj);      \</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span><span class="preprocessor">    val_(io).i = (x);        \</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span><span class="preprocessor">    settt_(io, LUA_VNUMINT); \</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span> </div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span><span class="comment">/* 改变整数值(假设已经是整数) */</span></div>
<div class="foldopen" id="foldopen00571" data-start="" data-end="">
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno"><a class="line" href="lobject_8h.html#ad7adb5b383285a385eb64b01de30966e">  571</a></span><span class="preprocessor">#define chgivalue(obj, x)        \</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span><span class="preprocessor">  {                              \</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span><span class="preprocessor">    TValue *io = (obj);          \</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span><span class="preprocessor">    lua_assert(ttisinteger(io)); \</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span><span class="preprocessor">    val_(io).i = (x);            \</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="comment">** 字符串</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="comment">**</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span><span class="comment">** Lua有两种字符串类型:</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span><span class="comment">** 1. 短字符串(short strings): 长度较小,被内部化(interned),相同内容</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span><span class="comment">**    的字符串只存储一份,通过哈希表管理</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span><span class="comment">** 2. 长字符串(long strings): 长度较大,不内部化</span></div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="comment">**</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span><span class="comment">** 短字符串可以通过指针比较相等性(因为相同字符串只有一个实例)</span></div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="comment">** 长字符串需要逐字节比较</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span><span class="comment">*/</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span><span class="comment">/* 字符串类型的变体标签 */</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno"><a class="line" href="lobject_8h.html#a794410ffd7267ef873eb05ac695b1ba6">  592</a></span><span class="preprocessor">#define LUA_VSHRSTR makevariant(LUA_TSTRING, 0) </span><span class="comment">/* 短字符串 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6869fcb0a0178b6d70d431eae1683199">  593</a></span><span class="preprocessor">#define LUA_VLNGSTR makevariant(LUA_TSTRING, 1) </span><span class="comment">/* 长字符串 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="comment">/* 测试是否为字符串 */</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno"><a class="line" href="lobject_8h.html#a9bdf057a0de8da2ffae3ac35662dd255">  596</a></span><span class="preprocessor">#define ttisstring(o) checktype((o), LUA_TSTRING)</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span><span class="comment">/* 测试是否为短字符串 */</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6513e161c7e8cc7276a9677d50a99b76">  598</a></span><span class="preprocessor">#define ttisshrstring(o) checktag((o), ctb(LUA_VSHRSTR))</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span><span class="comment">/* 测试是否为长字符串 */</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno"><a class="line" href="lobject_8h.html#a70613f10396708b6099f5e96fd9f668f">  600</a></span><span class="preprocessor">#define ttislngstring(o) checktag((o), ctb(LUA_VLNGSTR))</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span> </div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span><span class="comment">/* 获取原始TString指针,gco2ts将GCObject转换为TString */</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno"><a class="line" href="lobject_8h.html#a04fc217567b22a15b06483a8977c7914">  603</a></span><span class="preprocessor">#define tsvalueraw(v) (gco2ts((v).gc))</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span><span class="comment">/* 获取TString指针(带类型检查) */</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno"><a class="line" href="lobject_8h.html#a8661397faed512ccc9c70a4661f1a83d">  606</a></span><span class="preprocessor">#define tsvalue(o) check_exp(ttisstring(o), gco2ts(val_(o).gc))</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span><span class="comment">/*</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span><span class="comment">** 设置字符串值</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span><span class="comment">** 从TString的tt字段获取类型(短或长字符串)</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00612" data-start="" data-end="">
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno"><a class="line" href="lobject_8h.html#a251a2d3bada66aaed6249a89a0afe5f0">  612</a></span><span class="preprocessor">#define setsvalue(L, obj, x)   \</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span><span class="preprocessor">  {                            \</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span><span class="preprocessor">    TValue *io = (obj);        \</span></div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="preprocessor">    TString *x_ = (x);         \</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span><span class="preprocessor">    val_(io).gc = obj2gco(x_); \</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span><span class="preprocessor">    settt_(io, ctb(x_-&gt;tt));   \</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span><span class="preprocessor">    checkliveness(L, io);      \</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="comment">/* 设置栈上的字符串 */</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa60b4c3bb90063dcaa2f90e77d4a61f6">  622</a></span><span class="preprocessor">#define setsvalue2s(L, o, s) setsvalue(L, s2v(o), s)</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span> </div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="comment">/* 设置新对象的字符串 */</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa7a9ab918b0322fa100f3f7af16d2375">  625</a></span><span class="preprocessor">#define setsvalue2n setsvalue</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span><span class="comment">/*</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span><span class="comment">** 长字符串的种类(存储在shrlen字段中)</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span><span class="comment">**</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span><span class="comment">** shrlen是signed byte,对长字符串使用负值表示类型:</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="comment">*/</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno"><a class="line" href="lobject_8h.html#a635fdde3ae827010ccd9d8a589fba308">  632</a></span><span class="preprocessor">#define LSTRREG -1 </span><span class="comment">/* 常规长字符串(由Lua管理) */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno"><a class="line" href="lobject_8h.html#a2c3eeb80ec88dfec0040a6aab8c41b29">  633</a></span><span class="preprocessor">#define LSTRFIX -2 </span><span class="comment">/* 固定的外部长字符串(不会被GC) */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno"><a class="line" href="lobject_8h.html#a61922c271db007c07cca9b79a7f81b77">  634</a></span><span class="preprocessor">#define LSTRMEM -3 </span><span class="comment">/* 外部长字符串,带释放函数 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span> </div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="comment">/*</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span><span class="comment">** 字符串值的头部</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span><span class="comment">**</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="comment">** TString结构存储字符串的元信息和内容</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00643" data-start="{" data-end="};">
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno"><a class="line" href="structTString.html">  643</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structTString.html">TString</a></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>{</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno"><a class="line" href="structTString.html#a46677057221656f98fa80eb77089de45">  645</a></span>  <a class="code hl_variable" href="structTString.html#a46677057221656f98fa80eb77089de45">CommonHeader</a>;      <span class="comment">/* GC头部 */</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno"><a class="line" href="structTString.html#a11878b0fae7367ad203a0c470ee54fa1">  646</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structTString.html#a11878b0fae7367ad203a0c470ee54fa1">extra</a>;     <span class="comment">/* 短字符串:保留字标记; 长字符串:&quot;有哈希值&quot;标记 */</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno"><a class="line" href="structTString.html#a4daff60502f0255ec75513191424a9c7">  647</a></span>  <a class="code hl_typedef" href="llimits_8h.html#aab58a246c9e0a85c4c2ed0fd8d6724bb">ls_byte</a> <a class="code hl_variable" href="structTString.html#a4daff60502f0255ec75513191424a9c7">shrlen</a>;    <span class="comment">/* 短字符串:长度; 长字符串:负值表示类型 */</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno"><a class="line" href="structTString.html#a57f69ac2b4c4eb34f5521ffd68d90b5f">  648</a></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="structTString.html#a57f69ac2b4c4eb34f5521ffd68d90b5f">hash</a>; <span class="comment">/* 字符串的哈希值 */</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>  <span class="keyword">union</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>  {</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno"><a class="line" href="structTString.html#a25f3ee23e67e10eba379fa4f31dec5d2">  651</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_variable" href="structTString.html#a25f3ee23e67e10eba379fa4f31dec5d2">lnglen</a>;         <span class="comment">/* 长字符串的长度 */</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno"><a class="line" href="structTString.html#adb99ad67b6bc67f62fac7d69b88f07fd">  652</a></span>    <span class="keyword">struct </span><a class="code hl_struct" href="structTString.html">TString</a> *<a class="code hl_variable" href="structTString.html#adb99ad67b6bc67f62fac7d69b88f07fd">hnext</a>; <span class="comment">/* 哈希表链表(用于短字符串) */</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno"><a class="line" href="structTString.html#ada0c4b3ed24fc7a9f778259c7475e276">  653</a></span>  } <a class="code hl_variable" href="structTString.html#ada0c4b3ed24fc7a9f778259c7475e276">u</a>;</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno"><a class="line" href="structTString.html#ab794bd2b18ab7a16fa3f3b16669801d7">  654</a></span>  <span class="keywordtype">char</span> *<a class="code hl_variable" href="structTString.html#ab794bd2b18ab7a16fa3f3b16669801d7">contents</a>;   <span class="comment">/* 长字符串:指向内容的指针; 短字符串:未使用 */</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno"><a class="line" href="structTString.html#acad92742e5915e44fdbbeed12b3c244d">  655</a></span>  <a class="code hl_typedef" href="lua_8h.html#a2ba24df8972a4a52ebd3517c62e0830d">lua_Alloc</a> <a class="code hl_variable" href="structTString.html#acad92742e5915e44fdbbeed12b3c244d">falloc</a>; <span class="comment">/* 外部字符串的释放函数 */</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno"><a class="line" href="structTString.html#a4754301957abb501d3525ed5796611d6">  656</a></span>  <span class="keywordtype">void</span> *<a class="code hl_variable" href="structTString.html#a4754301957abb501d3525ed5796611d6">ud</a>;         <span class="comment">/* 外部字符串的用户数据 */</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno"><a class="line" href="lobject_8h.html#ad2189b9dc6af3f33b8aa3090dcde1535">  657</a></span>} <a class="code hl_struct" href="structTString.html">TString</a>;</div>
</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span><span class="comment">/* 测试是否为短字符串(shrlen非负) */</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno"><a class="line" href="lobject_8h.html#a9efb85b4343245b80e24baf9d0b31239">  660</a></span><span class="preprocessor">#define strisshr(ts) ((ts)-&gt;shrlen &gt;= 0)</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span><span class="comment">/* 测试是否为外部字符串 */</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno"><a class="line" href="lobject_8h.html#ab69390bf4886cbbef652025659081fc4">  662</a></span><span class="preprocessor">#define isextstr(ts) (ttislngstring(ts) &amp;&amp; tsvalue(ts)-&gt;shrlen != LSTRREG)</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span><span class="comment">/*</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span><span class="comment">** 从TString获取实际字符串(字节数组)</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span><span class="comment">**</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span><span class="comment">** 通用版本和短/长字符串的特化版本:</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span><span class="comment">** - 短字符串:内容紧跟在TString结构后面</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span><span class="comment">** - 长字符串:内容通过contents指针访问</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span><span class="comment">*/</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span><span class="comment">/* 获取短字符串内容(转换为char指针) */</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa3606bca2fbc2ca04a3a823a35623db9">  672</a></span><span class="preprocessor">#define rawgetshrstr(ts) (cast_charp(&amp;(ts)-&gt;contents))</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span><span class="comment">/* 获取短字符串(带检查) */</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno"><a class="line" href="lobject_8h.html#a053933b3a99d024e5f4879128d0a000c">  674</a></span><span class="preprocessor">#define getshrstr(ts) check_exp(strisshr(ts), rawgetshrstr(ts))</span></div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span><span class="comment">/* 获取长字符串 */</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno"><a class="line" href="lobject_8h.html#a325f4b36c75016ecca213448d2affd48">  676</a></span><span class="preprocessor">#define getlngstr(ts) check_exp(!strisshr(ts), (ts)-&gt;contents)</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span><span class="comment">/* 获取字符串(自动判断类型) */</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno"><a class="line" href="lobject_8h.html#acb05d3ab238923581a9c629b8e11a6ac">  678</a></span><span class="preprocessor">#define getstr(ts) (strisshr(ts) ? rawgetshrstr(ts) : (ts)-&gt;contents)</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span> </div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span><span class="comment">/*</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span><span class="comment">** 从TString获取字符串长度</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span><span class="comment">** cast_sizet将signed/unsigned转换为size_t</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00684" data-start="" data-end="">
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6c4d246a952e6f924801ec6226920163">  684</a></span><span class="preprocessor">#define tsslen(ts) \</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span><span class="preprocessor">  (strisshr(ts) ? cast_sizet((ts)-&gt;shrlen) : (ts)-&gt;u.lnglen)</span></div>
</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span> </div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span><span class="comment">/*</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span><span class="comment">** 获取字符串和长度</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span><span class="comment">**</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span><span class="comment">** 这个宏同时返回字符串指针和设置长度变量</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span><span class="comment">** 使用cast_void使表达式没有值,只有副作用(设置len)</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00693" data-start="" data-end="">
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno"><a class="line" href="lobject_8h.html#ae4aa3e739eca19baaa815852b81c4ed1">  693</a></span><span class="preprocessor">#define getlstr(ts, len)                                                 \</span></div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span><span class="preprocessor">  (strisshr(ts)                                                          \</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span><span class="preprocessor">       ? (cast_void((len) = cast_sizet((ts)-&gt;shrlen)), rawgetshrstr(ts)) \</span></div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span><span class="preprocessor">       : (cast_void((len) = (ts)-&gt;u.lnglen), (ts)-&gt;contents))</span></div>
</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span><span class="comment">** 用户数据(Userdata)</span></div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span><span class="comment">**</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span><span class="comment">** Lua支持两种用户数据:</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span><span class="comment">** 1. 轻量用户数据(light userdata): 只是一个C指针,不需要GC</span></div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span><span class="comment">** 2. 完全用户数据(full userdata): 由Lua管理的内存块,可以有元表和用户值</span></div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span><span class="comment">*/</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span> </div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span><span class="comment">/*</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span><span class="comment">** 轻量用户数据应该是用户数据的变体,但为了兼容性,它们是不同的类型</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="comment">**</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span><span class="comment">** 在Lua 5.0-5.2中,轻量用户数据是单独的类型</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span><span class="comment">** 为了向后兼容,5.3+仍保持这种设计</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span><span class="comment">*/</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno"><a class="line" href="lobject_8h.html#a0fe81163ea67e644d5a85078c4a6d25c">  713</a></span><span class="preprocessor">#define LUA_VLIGHTUSERDATA makevariant(LUA_TLIGHTUSERDATA, 0)</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span><span class="comment">/* 完全用户数据 */</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno"><a class="line" href="lobject_8h.html#af45b44d4031e7e869195dd97759d2ca3">  716</a></span><span class="preprocessor">#define LUA_VUSERDATA makevariant(LUA_TUSERDATA, 0)</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span><span class="comment">/* 测试是否为轻量用户数据 */</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6440445277dce2e73af1e043f9884d7a">  719</a></span><span class="preprocessor">#define ttislightuserdata(o) checktag((o), LUA_VLIGHTUSERDATA)</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span><span class="comment">/* 测试是否为完全用户数据 */</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno"><a class="line" href="lobject_8h.html#a2b0d95af67f53d9fe2bdde605f9cd957">  721</a></span><span class="preprocessor">#define ttisfulluserdata(o) checktag((o), ctb(LUA_VUSERDATA))</span></div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span> </div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span><span class="comment">/* 获取轻量用户数据的指针 */</span></div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno"><a class="line" href="lobject_8h.html#a16c0267c035b3e4edda082e25069e8cf">  724</a></span><span class="preprocessor">#define pvalue(o) check_exp(ttislightuserdata(o), val_(o).p)</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="comment">/* 获取完全用户数据,gco2u转换为Udata */</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno"><a class="line" href="lobject_8h.html#a1c49f55d93297e833141fb62903af3ad">  726</a></span><span class="preprocessor">#define uvalue(o) check_exp(ttisfulluserdata(o), gco2u(val_(o).gc))</span></div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span> </div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span><span class="comment">/* 获取原始指针 */</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno"><a class="line" href="lobject_8h.html#ac63f7b6c7f725eaece22d3e7ea198001">  729</a></span><span class="preprocessor">#define pvalueraw(v) ((v).p)</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span> </div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span><span class="comment">/* 设置轻量用户数据 */</span></div>
<div class="foldopen" id="foldopen00732" data-start="" data-end="">
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno"><a class="line" href="lobject_8h.html#a0784c90d154ccf7c643b56a00c62412a">  732</a></span><span class="preprocessor">#define setpvalue(obj, x)           \</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span><span class="preprocessor">  {                                 \</span></div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span><span class="preprocessor">    TValue *io = (obj);             \</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span><span class="preprocessor">    val_(io).p = (x);               \</span></div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span><span class="preprocessor">    settt_(io, LUA_VLIGHTUSERDATA); \</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span> </div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span><span class="comment">/* 设置完全用户数据 */</span></div>
<div class="foldopen" id="foldopen00740" data-start="" data-end="">
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno"><a class="line" href="lobject_8h.html#ab358ecf44046d8def185fed182944fc1">  740</a></span><span class="preprocessor">#define setuvalue(L, obj, x)        \</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span><span class="preprocessor">  {                                 \</span></div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span><span class="preprocessor">    TValue *io = (obj);             \</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span><span class="preprocessor">    Udata *x_ = (x);                \</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span><span class="preprocessor">    val_(io).gc = obj2gco(x_);      \</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span><span class="preprocessor">    settt_(io, ctb(LUA_VUSERDATA)); \</span></div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span><span class="preprocessor">    checkliveness(L, io);           \</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span> </div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span><span class="comment">/*</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span><span class="comment">** 确保此类型后的地址总是完全对齐</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span><span class="comment">**</span></div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span><span class="comment">** LUAI_MAXALIGN是平台相关的最大对齐类型(如double或long long)</span></div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span><span class="comment">** 这确保用户数据的字节数据有正确的对齐</span></div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00755" data-start="{" data-end="};">
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno"><a class="line" href="unionUValue.html">  755</a></span><span class="keyword">typedef</span> <span class="keyword">union </span><a class="code hl_union" href="unionUValue.html">UValue</a></div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>{</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno"><a class="line" href="unionUValue.html#afaa156bae31b8f21eb9743c2a757ce89">  757</a></span>  <a class="code hl_struct" href="structTValue.html">TValue</a> <a class="code hl_variable" href="unionUValue.html#afaa156bae31b8f21eb9743c2a757ce89">uv</a>;     <span class="comment">/* 用户值 */</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno"><a class="line" href="unionUValue.html#a3257500ea5d9b5b592f1ff8f31f1dda3">  758</a></span>  <a class="code hl_variable" href="unionUValue.html#a3257500ea5d9b5b592f1ff8f31f1dda3">LUAI_MAXALIGN</a>; <span class="comment">/* 确保udata字节的最大对齐 */</span></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno"><a class="line" href="lobject_8h.html#a4a9abc9c2064ec3a4620a1f1c30f18af">  759</a></span>} <a class="code hl_union" href="unionUValue.html">UValue</a>;</div>
</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="comment">/*</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="comment">** 带用户值的用户数据头部</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span><span class="comment">**</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span><span class="comment">** 用户数据可以关联多个&quot;用户值&quot;(user values),这些是Lua值,</span></div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span><span class="comment">** 可以从用户数据访问,主要用于存储与用户数据相关的Lua对象</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span><span class="comment">**</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span><span class="comment">** 内存区域紧跟在此结构末尾</span></div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00771" data-start="{" data-end="};">
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno"><a class="line" href="structUdata.html">  771</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structUdata.html">Udata</a></div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>{</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno"><a class="line" href="structUdata.html#aaa6ffd32850e8506f6fa4c441702d374">  773</a></span>  <a class="code hl_variable" href="structUdata.html#aaa6ffd32850e8506f6fa4c441702d374">CommonHeader</a>;            <span class="comment">/* GC头部 */</span></div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno"><a class="line" href="structUdata.html#a676537b4656a8bdcf2e61f88ed5f6848">  774</a></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_variable" href="structUdata.html#a676537b4656a8bdcf2e61f88ed5f6848">nuvalue</a>;  <span class="comment">/* 用户值的数量 */</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno"><a class="line" href="structUdata.html#abc467c0c1ec8511376150eb728514dc5">  775</a></span>  <span class="keywordtype">size_t</span> <a class="code hl_variable" href="structUdata.html#abc467c0c1ec8511376150eb728514dc5">len</a>;              <span class="comment">/* 字节数(用户数据块的大小) */</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno"><a class="line" href="structUdata.html#a39f828bdcf3f046e285ffbecfcaea56b">  776</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structTable.html">Table</a> *<a class="code hl_variable" href="structUdata.html#a39f828bdcf3f046e285ffbecfcaea56b">metatable</a>; <span class="comment">/* 元表 */</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno"><a class="line" href="structUdata.html#af984abb747b485c84ea97362d843d897">  777</a></span>  <a class="code hl_struct" href="structGCObject.html">GCObject</a> *<a class="code hl_variable" href="structUdata.html#af984abb747b485c84ea97362d843d897">gclist</a>;        <span class="comment">/* GC链表 */</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno"><a class="line" href="structUdata.html#abfc560a8436c8a9c238b175706beab7b">  778</a></span>  <a class="code hl_union" href="unionUValue.html">UValue</a> <a class="code hl_variable" href="structUdata.html#abfc560a8436c8a9c238b175706beab7b">uv</a>[1];            <span class="comment">/* 用户值数组(柔性数组) */</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno"><a class="line" href="lobject_8h.html#a5bc1974b5ddc941b400e1b1b058f95f1">  779</a></span>} <a class="code hl_struct" href="structUdata.html">Udata</a>;</div>
</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span> </div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span><span class="comment">/*</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span><span class="comment">** 无用户值的用户数据头部</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span><span class="comment">**</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span><span class="comment">** 没有用户值的用户数据在GC期间不需要变灰,因此不需要gclist字段</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span><span class="comment">**</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span><span class="comment">** 为简化代码,总是使用Udata,但确保不访问无用户值时的gclist</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span><span class="comment">** 这个结构仅用于计算此表示的正确大小</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span><span class="comment">** (末尾的bindata字段确保后续二进制数据的正确对齐)</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00792" data-start="{" data-end="};">
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno"><a class="line" href="structUdata0.html">  792</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structUdata0.html">Udata0</a></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>{</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno"><a class="line" href="structUdata0.html#ac6c257c24240939a6026e1c2bb755502">  794</a></span>  <a class="code hl_variable" href="structUdata0.html#ac6c257c24240939a6026e1c2bb755502">CommonHeader</a>;</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno"><a class="line" href="structUdata0.html#a46a84ae455cc55d4c8379ff4480b9e4f">  795</a></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code hl_variable" href="structUdata0.html#a46a84ae455cc55d4c8379ff4480b9e4f">nuvalue</a>; <span class="comment">/* 用户值数量(总是0) */</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno"><a class="line" href="structUdata0.html#af08d0105d68e5babd31e76745c5aa1e9">  796</a></span>  <span class="keywordtype">size_t</span> <a class="code hl_variable" href="structUdata0.html#af08d0105d68e5babd31e76745c5aa1e9">len</a>;             <span class="comment">/* 字节数 */</span></div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno"><a class="line" href="structUdata0.html#af7639961b49bdd3c3f3e695c2f035b24">  797</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structTable.html">Table</a> *<a class="code hl_variable" href="structUdata0.html#af7639961b49bdd3c3f3e695c2f035b24">metatable</a>;</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>  <span class="keyword">union</span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>  {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno"><a class="line" href="structUdata0.html#a0931d5764b287f7d4f6e2a0b3fdd46f7">  800</a></span>    <a class="code hl_variable" href="structUdata0.html#a0931d5764b287f7d4f6e2a0b3fdd46f7">LUAI_MAXALIGN</a>;</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno"><a class="line" href="structUdata0.html#a1a561b22c16bc76f669e976afee7d386">  801</a></span>  } <a class="code hl_variable" href="structUdata0.html#a1a561b22c16bc76f669e976afee7d386">bindata</a>; <span class="comment">/* 确保对齐 */</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno"><a class="line" href="lobject_8h.html#a33aa9feb0273304758472bccb2a6a4a6">  802</a></span>} <a class="code hl_struct" href="structUdata0.html">Udata0</a>;</div>
</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span><span class="comment">/*</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span><span class="comment">** 计算用户数据内存区域的偏移量</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span><span class="comment">**</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span><span class="comment">** nuv==0时使用Udata0布局(无gclist),否则使用Udata布局</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span><span class="comment">** offsetof是C标准库宏,计算结构体成员的偏移量</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00810" data-start="" data-end="">
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno"><a class="line" href="lobject_8h.html#aef06056b207ac5efd6fb0b0a2b3165d5">  810</a></span><span class="preprocessor">#define udatamemoffset(nuv)               \</span></div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span><span class="preprocessor">  ((nuv) == 0 ? offsetof(Udata0, bindata) \</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span><span class="preprocessor">              : offsetof(Udata, uv) + (sizeof(UValue) * (nuv)))</span></div>
</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span><span class="comment">/*</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span><span class="comment">** 获取Udata内存块的地址</span></div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span><span class="comment">** cast_charp转换为char指针以进行字节级算术</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span><span class="comment">*/</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno"><a class="line" href="lobject_8h.html#a2caa96489ffdf9759e50fda47d69f605">  818</a></span><span class="preprocessor">#define getudatamem(u) (cast_charp(u) + udatamemoffset((u)-&gt;nuvalue))</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span> </div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span><span class="comment">/* 计算用户数据的大小(头部+用户值+用户内存) */</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno"><a class="line" href="lobject_8h.html#a762595cf399516b83e0f5580a9a3a7b9">  821</a></span><span class="preprocessor">#define sizeudata(nuv, nb) (udatamemoffset(nuv) + (nb))</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span> </div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span><span class="comment">** 函数原型(Prototypes)</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span><span class="comment">**</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span><span class="comment">** Proto存储Lua函数的编译后信息:</span></div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span><span class="comment">** - 字节码指令</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span><span class="comment">** - 常量</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span><span class="comment">** - 调试信息</span></div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span><span class="comment">** - 嵌套函数</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span><span class="comment">** - 上值描述</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span><span class="comment">*/</span></div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span> </div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span><span class="comment">/* 原型类型标签 */</span></div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno"><a class="line" href="lobject_8h.html#a1c6c32cba3e6d0c897f68ceb273dd757">  836</a></span><span class="preprocessor">#define LUA_VPROTO makevariant(LUA_TPROTO, 0)</span></div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span> </div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span><span class="comment">/*</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span><span class="comment">** 指令类型</span></div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span><span class="comment">** l_uint32通常是uint32_t,一条指令占4字节</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span><span class="comment">*/</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa81d2e7f7263ef29946852d4966a192e">  842</a></span><span class="keyword">typedef</span> <a class="code hl_typedef" href="llimits_8h.html#abeb00a444eb1dc99a4a2baee15bd898a">l_uint32</a> <a class="code hl_typedef" href="lobject_8h.html#aa81d2e7f7263ef29946852d4966a192e">Instruction</a>;</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span> </div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span><span class="comment">/*</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span><span class="comment">** 函数原型的上值描述</span></div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span><span class="comment">**</span></div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span><span class="comment">** 上值是闭包捕获的外部局部变量</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00851" data-start="{" data-end="};">
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno"><a class="line" href="structUpvaldesc.html">  851</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structUpvaldesc.html">Upvaldesc</a></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>{</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno"><a class="line" href="structUpvaldesc.html#a8870289fbc6611275d093ef1c08cf9ed">  853</a></span>  <a class="code hl_struct" href="structTString.html">TString</a> *<a class="code hl_variable" href="structUpvaldesc.html#a8870289fbc6611275d093ef1c08cf9ed">name</a>;   <span class="comment">/* 上值名称(用于调试信息) */</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno"><a class="line" href="structUpvaldesc.html#a1e5182ac7b8b72848ed71b7b4844e3d1">  854</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structUpvaldesc.html#a1e5182ac7b8b72848ed71b7b4844e3d1">instack</a>; <span class="comment">/* 是否在栈中(寄存器),否则在外部函数的上值列表中 */</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno"><a class="line" href="structUpvaldesc.html#a8478ecca9cb593200c562a0837aedfac">  855</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structUpvaldesc.html#a8478ecca9cb593200c562a0837aedfac">idx</a>;     <span class="comment">/* 上值的索引(在栈中或在外部函数列表中) */</span></div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno"><a class="line" href="structUpvaldesc.html#a1315fb98c5f398c3f3323967cb9ec7ba">  856</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structUpvaldesc.html#a1315fb98c5f398c3f3323967cb9ec7ba">kind</a>;    <span class="comment">/* 对应变量的种类(常规、常量等) */</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno"><a class="line" href="lobject_8h.html#a8e51aa6ac9ae7599a39adc3bb297bd86">  857</a></span>} <a class="code hl_struct" href="structUpvaldesc.html">Upvaldesc</a>;</div>
</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span><span class="comment">/*</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span><span class="comment">** 函数原型的局部变量描述</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span><span class="comment">**</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span><span class="comment">** 用于调试信息,记录变量的作用域</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00866" data-start="{" data-end="};">
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno"><a class="line" href="structLocVar.html">  866</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structLocVar.html">LocVar</a></div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>{</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno"><a class="line" href="structLocVar.html#acf62684d78349320b90b4acfa3b6d22a">  868</a></span>  <a class="code hl_struct" href="structTString.html">TString</a> *<a class="code hl_variable" href="structLocVar.html#acf62684d78349320b90b4acfa3b6d22a">varname</a>; <span class="comment">/* 变量名 */</span></div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno"><a class="line" href="structLocVar.html#ac5a8bf5a59430eea070db5b1a97d8b88">  869</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structLocVar.html#ac5a8bf5a59430eea070db5b1a97d8b88">startpc</a>;      <span class="comment">/* 变量激活的第一个指令位置 */</span></div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno"><a class="line" href="structLocVar.html#af7f0f7d509579ffec5610e329f85693b">  870</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structLocVar.html#af7f0f7d509579ffec5610e329f85693b">endpc</a>;        <span class="comment">/* 变量失效的第一个指令位置 */</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno"><a class="line" href="lobject_8h.html#abfe5d6df698ce5c78a1e911fe5860466">  871</a></span>} <a class="code hl_struct" href="structLocVar.html">LocVar</a>;</div>
</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span> </div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span><span class="comment">/*</span></div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span><span class="comment">** 绝对行信息关联</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span><span class="comment">**</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span><span class="comment">** 为给定指令(pc)关联绝对源代码行号</span></div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span><span class="comment">**</span></div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span><span class="comment">** lineinfo数组为每条指令给出与前一条指令的行差</span></div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span><span class="comment">** 当差值太大无法放入一个字节时,Lua保存该指令的绝对行号</span></div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span><span class="comment">** (Lua也周期性保存绝对行号,以加速行号计算:可以在绝对行数组中</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span><span class="comment">** 使用二分查找,但必须线性遍历lineinfo数组)</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00885" data-start="{" data-end="};">
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno"><a class="line" href="structAbsLineInfo.html">  885</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structAbsLineInfo.html">AbsLineInfo</a></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>{</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno"><a class="line" href="structAbsLineInfo.html#aadedc41698239b3660609c2d2319f46f">  887</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structAbsLineInfo.html#aadedc41698239b3660609c2d2319f46f">pc</a>;   <span class="comment">/* 程序计数器(指令索引) */</span></div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno"><a class="line" href="structAbsLineInfo.html#aeaae3dad0ef96232c843f79d378e6272">  888</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structAbsLineInfo.html#aeaae3dad0ef96232c843f79d378e6272">line</a>; <span class="comment">/* 对应的绝对行号 */</span></div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno"><a class="line" href="lobject_8h.html#a5c84f9e449c687325b7ad4359474aa22">  889</a></span>} <a class="code hl_struct" href="structAbsLineInfo.html">AbsLineInfo</a>;</div>
</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span> </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span><span class="comment">/*</span></div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span><span class="comment">** 原型中的标志</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span><span class="comment">*/</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno"><a class="line" href="lobject_8h.html#afcdc78bd96b64ec611012547081dfd27">  896</a></span><span class="preprocessor">#define PF_VAHID 1 </span><span class="comment">/* 函数有隐藏的可变参数 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno"><a class="line" href="lobject_8h.html#a537550afe7dd14d7cf2e5a8f6d438490">  897</a></span><span class="preprocessor">#define PF_VATAB 2 </span><span class="comment">/* 函数有可变参数表 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno"><a class="line" href="lobject_8h.html#a258afaabf3edee5f46c6e798fc0dec8b">  898</a></span><span class="preprocessor">#define PF_FIXED 4 </span><span class="comment">/* 原型的部分在固定内存中 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span> </div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span><span class="comment">/* 可变参数函数要么有隐藏参数,要么有可变参数表 */</span></div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6c187940212c576898ee8f0b00c51fa0">  901</a></span><span class="preprocessor">#define isvararg(p) ((p)-&gt;flag &amp; (PF_VAHID | PF_VATAB))</span></div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span> </div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span><span class="comment">/*</span></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span><span class="comment">** 标记函数需要可变参数表</span></div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span><span class="comment">** (PF_VAHID标志稍后会被清除)</span></div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span><span class="comment">*/</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno"><a class="line" href="lobject_8h.html#a4bbf37539e0e1d5440fb28a154c96511">  907</a></span><span class="preprocessor">#define needvatab(p) ((p)-&gt;flag |= PF_VATAB)</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span> </div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span><span class="comment">/*</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span><span class="comment">** 函数原型结构</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span><span class="comment">**</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span><span class="comment">** 这是Lua函数编译后的表示,包含执行所需的所有信息</span></div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00916" data-start="{" data-end="};">
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno"><a class="line" href="structProto.html">  916</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structProto.html">Proto</a></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>{</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno"><a class="line" href="structProto.html#a5b0bf6a93e383f0a873573b9c99dfb95">  918</a></span>  <a class="code hl_variable" href="structProto.html#a5b0bf6a93e383f0a873573b9c99dfb95">CommonHeader</a>;             <span class="comment">/* GC头部 */</span></div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno"><a class="line" href="structProto.html#a3f106f177af6c68ffd8b042713266b98">  919</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structProto.html#a3f106f177af6c68ffd8b042713266b98">numparams</a>;        <span class="comment">/* 固定(命名)参数的数量 */</span></div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno"><a class="line" href="structProto.html#a16d8b2f349f89bdeabda995cf96c1fb0">  920</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structProto.html#a16d8b2f349f89bdeabda995cf96c1fb0">flag</a>;             <span class="comment">/* 标志(可变参数等) */</span></div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno"><a class="line" href="structProto.html#a9c9ed4e9d996233f75cdf56b912e4803">  921</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structProto.html#a9c9ed4e9d996233f75cdf56b912e4803">maxstacksize</a>;     <span class="comment">/* 此函数需要的寄存器数量 */</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno"><a class="line" href="structProto.html#a6ecec897497ba7d94df6ef69289ef5c0">  922</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a6ecec897497ba7d94df6ef69289ef5c0">sizeupvalues</a>;         <span class="comment">/* upvalues数组的大小 */</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno"><a class="line" href="structProto.html#a5bd719e0486168f6ecd4b01bf41a7444">  923</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a5bd719e0486168f6ecd4b01bf41a7444">sizek</a>;                <span class="comment">/* k数组的大小(常量数) */</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno"><a class="line" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">  924</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">sizecode</a>;             <span class="comment">/* code数组的大小(指令数) */</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno"><a class="line" href="structProto.html#a65303ae1d815313f3358a578113fcc6e">  925</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a65303ae1d815313f3358a578113fcc6e">sizelineinfo</a>;         <span class="comment">/* lineinfo数组的大小 */</span></div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno"><a class="line" href="structProto.html#a73ddad1a18b7c46be46ec32aa2a08632">  926</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a73ddad1a18b7c46be46ec32aa2a08632">sizep</a>;                <span class="comment">/* p数组的大小(嵌套函数数) */</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno"><a class="line" href="structProto.html#ac2ab37e941e8866687f44f7b2f4b95a9">  927</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#ac2ab37e941e8866687f44f7b2f4b95a9">sizelocvars</a>;          <span class="comment">/* locvars数组的大小 */</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno"><a class="line" href="structProto.html#a48c289d2c5198fb3bb997196943e9902">  928</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a48c289d2c5198fb3bb997196943e9902">sizeabslineinfo</a>;      <span class="comment">/* abslineinfo数组的大小 */</span></div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno"><a class="line" href="structProto.html#a62cf1c61b70bfaa4f1fb839b7398160b">  929</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a62cf1c61b70bfaa4f1fb839b7398160b">linedefined</a>;          <span class="comment">/* 函数定义开始的行号 */</span></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno"><a class="line" href="structProto.html#a9ef7fae1b22b11f5a145cfee8150059c">  930</a></span>  <span class="keywordtype">int</span> <a class="code hl_variable" href="structProto.html#a9ef7fae1b22b11f5a145cfee8150059c">lastlinedefined</a>;      <span class="comment">/* 函数定义结束的行号 */</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno"><a class="line" href="structProto.html#ae292fb0c0558679704933824ce96eac2">  931</a></span>  <a class="code hl_struct" href="structTValue.html">TValue</a> *<a class="code hl_variable" href="structProto.html#ae292fb0c0558679704933824ce96eac2">k</a>;                <span class="comment">/* 函数使用的常量数组 */</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno"><a class="line" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">  932</a></span>  <a class="code hl_typedef" href="lobject_8h.html#aa81d2e7f7263ef29946852d4966a192e">Instruction</a> *<a class="code hl_variable" href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">code</a>;        <span class="comment">/* 操作码数组(字节码) */</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno"><a class="line" href="structProto.html#a54dc8e2e8973007794fa0ab0e4a71461">  933</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structProto.html">Proto</a> **<a class="code hl_variable" href="structProto.html#a54dc8e2e8973007794fa0ab0e4a71461">p</a>;         <span class="comment">/* 函数内定义的函数数组 */</span></div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno"><a class="line" href="structProto.html#a028070514796b4accbd99c59e6b83930">  934</a></span>  <a class="code hl_struct" href="structUpvaldesc.html">Upvaldesc</a> *<a class="code hl_variable" href="structProto.html#a028070514796b4accbd99c59e6b83930">upvalues</a>;      <span class="comment">/* 上值信息数组 */</span></div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno"><a class="line" href="structProto.html#a4d8b6a245668e28870027f70a98cce98">  935</a></span>  <a class="code hl_typedef" href="llimits_8h.html#aab58a246c9e0a85c4c2ed0fd8d6724bb">ls_byte</a> *<a class="code hl_variable" href="structProto.html#a4d8b6a245668e28870027f70a98cce98">lineinfo</a>;        <span class="comment">/* 源代码行信息(调试) */</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno"><a class="line" href="structProto.html#a012268f6cdec514d296b50356decff4e">  936</a></span>  <a class="code hl_struct" href="structAbsLineInfo.html">AbsLineInfo</a> *<a class="code hl_variable" href="structProto.html#a012268f6cdec514d296b50356decff4e">abslineinfo</a>; <span class="comment">/* 绝对行信息(调试) */</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno"><a class="line" href="structProto.html#a41d627972548e1a6aaf358480ed46f69">  937</a></span>  <a class="code hl_struct" href="structLocVar.html">LocVar</a> *<a class="code hl_variable" href="structProto.html#a41d627972548e1a6aaf358480ed46f69">locvars</a>;          <span class="comment">/* 局部变量信息(调试) */</span></div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno"><a class="line" href="structProto.html#a92b6ec319e7aa1ee8b8ff7807353ad96">  938</a></span>  <a class="code hl_struct" href="structTString.html">TString</a> *<a class="code hl_variable" href="structProto.html#a92b6ec319e7aa1ee8b8ff7807353ad96">source</a>;          <span class="comment">/* 源文件名(调试) */</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno"><a class="line" href="structProto.html#a7991ec396b493a42b5c7f38b4e162959">  939</a></span>  <a class="code hl_struct" href="structGCObject.html">GCObject</a> *<a class="code hl_variable" href="structProto.html#a7991ec396b493a42b5c7f38b4e162959">gclist</a>;         <span class="comment">/* GC链表 */</span></div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno"><a class="line" href="lobject_8h.html#aecc6ed5be1952ae8617cbcbebe2a530c">  940</a></span>} <a class="code hl_struct" href="structProto.html">Proto</a>;</div>
</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span> </div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span><span class="comment">** 函数</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span><span class="comment">**</span></div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span><span class="comment">** Lua支持多种函数类型:</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span><span class="comment">** 1. Lua闭包(LClosure): Lua函数,带上值</span></div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span><span class="comment">** 2. C闭包(CClosure): C函数,带上值</span></div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span><span class="comment">** 3. 轻量C函数(light C function): 直接的C函数指针,无上值</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span><span class="comment">*/</span></div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span> </div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span><span class="comment">/* 上值类型标签 */</span></div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno"><a class="line" href="lobject_8h.html#ae982db94518ed52587579ed70d822ad5">  953</a></span><span class="preprocessor">#define LUA_VUPVAL makevariant(LUA_TUPVAL, 0)</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span> </div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span><span class="comment">/* 函数类型的变体标签 */</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno"><a class="line" href="lobject_8h.html#a5d0e6e41ea93960667095501aa5745c1">  956</a></span><span class="preprocessor">#define LUA_VLCL makevariant(LUA_TFUNCTION, 0) </span><span class="comment">/* Lua闭包 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno"><a class="line" href="lobject_8h.html#a9b9abbdd10fec20fc7a746efd903872d">  957</a></span><span class="preprocessor">#define LUA_VLCF makevariant(LUA_TFUNCTION, 1) </span><span class="comment">/* 轻量C函数 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno"><a class="line" href="lobject_8h.html#a2361d923ddb7fc1468b978fe043e35c2">  958</a></span><span class="preprocessor">#define LUA_VCCL makevariant(LUA_TFUNCTION, 2) </span><span class="comment">/* C闭包 */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span> </div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span><span class="comment">/* 测试是否为函数 */</span></div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno"><a class="line" href="lobject_8h.html#a48587dcb78721d149d3184d0768f4950">  961</a></span><span class="preprocessor">#define ttisfunction(o) checktype(o, LUA_TFUNCTION)</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span><span class="comment">/* 测试是否为Lua闭包 */</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6f8bada57bc9f224609af800d399693f">  963</a></span><span class="preprocessor">#define ttisLclosure(o) checktag((o), ctb(LUA_VLCL))</span></div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span><span class="comment">/* 测试是否为轻量C函数 */</span></div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno"><a class="line" href="lobject_8h.html#a8d43f35dfc5fcd0ee49a6206d63bec18">  965</a></span><span class="preprocessor">#define ttislcf(o) checktag((o), LUA_VLCF)</span></div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span><span class="comment">/* 测试是否为C闭包 */</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno"><a class="line" href="lobject_8h.html#a9510da9838a8f17b4eef364549a4c7a8">  967</a></span><span class="preprocessor">#define ttisCclosure(o) checktag((o), ctb(LUA_VCCL))</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span><span class="comment">/* 测试是否为闭包(Lua或C) */</span></div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno"><a class="line" href="lobject_8h.html#a3254d5797537bb83d10a5b48dc6b4377">  969</a></span><span class="preprocessor">#define ttisclosure(o) (ttisLclosure(o) || ttisCclosure(o))</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span> </div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span><span class="comment">/* 测试是否为Lua函数 */</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno"><a class="line" href="lobject_8h.html#a6e8ea4626fad5e23912d4e26d0b09200">  972</a></span><span class="preprocessor">#define isLfunction(o) ttisLclosure(o)</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span> </div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span><span class="comment">/* 获取闭包(自动判断类型),gco2cl转换为Closure */</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno"><a class="line" href="lobject_8h.html#a4b49383d348897fe282c0d51354d8bc9">  975</a></span><span class="preprocessor">#define clvalue(o) check_exp(ttisclosure(o), gco2cl(val_(o).gc))</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span><span class="comment">/* 获取Lua闭包,gco2lcl转换为LClosure */</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno"><a class="line" href="lobject_8h.html#afb9e65b01574a1135c582cf28883062e">  977</a></span><span class="preprocessor">#define clLvalue(o) check_exp(ttisLclosure(o), gco2lcl(val_(o).gc))</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span><span class="comment">/* 获取轻量C函数指针 */</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno"><a class="line" href="lobject_8h.html#a27d0b4b700445d8c82ddc634c0252d10">  979</a></span><span class="preprocessor">#define fvalue(o) check_exp(ttislcf(o), val_(o).f)</span></div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span><span class="comment">/* 获取C闭包,gco2ccl转换为CClosure */</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno"><a class="line" href="lobject_8h.html#a2c2d10bdd241446b4c9e1b68268159bc">  981</a></span><span class="preprocessor">#define clCvalue(o) check_exp(ttisCclosure(o), gco2ccl(val_(o).gc))</span></div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span> </div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span><span class="comment">/* 获取原始函数指针 */</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno"><a class="line" href="lobject_8h.html#a5bfafd2ed3da7d3e31562ffb9d73fc7c">  984</a></span><span class="preprocessor">#define fvalueraw(v) ((v).f)</span></div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span> </div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span><span class="comment">/* 设置Lua闭包 */</span></div>
<div class="foldopen" id="foldopen00987" data-start="" data-end="">
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno"><a class="line" href="lobject_8h.html#ac1765c700e6c8eaa1e36b397cc5439f7">  987</a></span><span class="preprocessor">#define setclLvalue(L, obj, x) \</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span><span class="preprocessor">  {                            \</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span><span class="preprocessor">    TValue *io = (obj);        \</span></div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span><span class="preprocessor">    LClosure *x_ = (x);        \</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span><span class="preprocessor">    val_(io).gc = obj2gco(x_); \</span></div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span><span class="preprocessor">    settt_(io, ctb(LUA_VLCL)); \</span></div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span><span class="preprocessor">    checkliveness(L, io);      \</span></div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span> </div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span><span class="comment">/* 设置栈上的Lua闭包 */</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno"><a class="line" href="lobject_8h.html#a3e4e5270b0c50551ed8c3a0367f56d14">  997</a></span><span class="preprocessor">#define setclLvalue2s(L, o, cl) setclLvalue(L, s2v(o), cl)</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span> </div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span><span class="comment">/* 设置轻量C函数 */</span></div>
<div class="foldopen" id="foldopen01000" data-start="" data-end="">
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"><a class="line" href="lobject_8h.html#a449f6c91562897c555ff32b360a6042f"> 1000</a></span><span class="preprocessor">#define setfvalue(obj, x) \</span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span><span class="preprocessor">  {                       \</span></div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span><span class="preprocessor">    TValue *io = (obj);   \</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span><span class="preprocessor">    val_(io).f = (x);     \</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span><span class="preprocessor">    settt_(io, LUA_VLCF); \</span></div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span> </div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span><span class="comment">/* 设置C闭包 */</span></div>
<div class="foldopen" id="foldopen01008" data-start="" data-end="">
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"><a class="line" href="lobject_8h.html#a57d9fee6a3a8d1eb4b36c95cf76ab09d"> 1008</a></span><span class="preprocessor">#define setclCvalue(L, obj, x) \</span></div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span><span class="preprocessor">  {                            \</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span><span class="preprocessor">    TValue *io = (obj);        \</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span><span class="preprocessor">    CClosure *x_ = (x);        \</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span><span class="preprocessor">    val_(io).gc = obj2gco(x_); \</span></div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span><span class="preprocessor">    settt_(io, ctb(LUA_VCCL)); \</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span><span class="preprocessor">    checkliveness(L, io);      \</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span> </div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span><span class="comment">/*</span></div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span><span class="comment">** Lua闭包的上值</span></div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span><span class="comment">**</span></div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span><span class="comment">** 上值(UpVal)用于实现闭包对外部局部变量的捕获</span></div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span><span class="comment">**</span></div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span><span class="comment">** 上值可以是&quot;开放的&quot;或&quot;关闭的&quot;:</span></div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span><span class="comment">** - 开放的上值:指向仍在栈上的变量</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span><span class="comment">** - 关闭的上值:变量已离开栈,值被复制到上值对象中</span></div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01028" data-start="{" data-end="};">
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"><a class="line" href="structUpVal.html"> 1028</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structUpVal.html">UpVal</a></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>{</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"><a class="line" href="structUpVal.html#a4e31d0a4bda814a7173a9ef5ca88ba3c"> 1030</a></span>  <a class="code hl_variable" href="structUpVal.html#a4e31d0a4bda814a7173a9ef5ca88ba3c">CommonHeader</a>; <span class="comment">/* GC头部 */</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>  <span class="keyword">union</span></div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>  {</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"><a class="line" href="structUpVal.html#a8e9dff354074323b0df2bd0795b6e9d3"> 1033</a></span>    <a class="code hl_struct" href="structTValue.html">TValue</a> *<a class="code hl_variable" href="structUpVal.html#a8e9dff354074323b0df2bd0795b6e9d3">p</a>;        <span class="comment">/* 指向栈或自己的value(开放/关闭) */</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"><a class="line" href="structUpVal.html#a5181153fb4139bfe1246bfff44700216"> 1034</a></span>    ptrdiff_t <a class="code hl_variable" href="structUpVal.html#a5181153fb4139bfe1246bfff44700216">offset</a>; <span class="comment">/* 栈重分配时使用的偏移量 */</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"><a class="line" href="structUpVal.html#ae884e7120e776fd0699a9bdc02403480"> 1035</a></span>  } <a class="code hl_variable" href="structUpVal.html#ae884e7120e776fd0699a9bdc02403480">v</a>;</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>  <span class="keyword">union</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>  {</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <span class="keyword">struct</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    {                          <span class="comment">/* (当开放时) */</span></div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"><a class="line" href="structUpVal.html#ad60d3e0af32d663d3cde2e033bbdefd8"> 1040</a></span>      <span class="keyword">struct </span><a class="code hl_struct" href="structUpVal.html">UpVal</a> *<a class="code hl_variable" href="structUpVal.html#ad60d3e0af32d663d3cde2e033bbdefd8">next</a>;      <span class="comment">/* 链表 */</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"><a class="line" href="structUpVal.html#af88c50a2df90e5e84a6abedde641771a"> 1041</a></span>      <span class="keyword">struct </span><a class="code hl_struct" href="structUpVal.html">UpVal</a> **<a class="code hl_variable" href="structUpVal.html#af88c50a2df90e5e84a6abedde641771a">previous</a>; <span class="comment">/* 双向链表 */</span></div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"><a class="line" href="structUpVal.html#a1f7fa9c8703aad994bd21edad8b0c027"> 1042</a></span>    } <a class="code hl_variable" href="structUpVal.html#a1f7fa9c8703aad994bd21edad8b0c027">open</a>;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"><a class="line" href="structUpVal.html#abc22d06bbcaf3f197af9c6069c562505"> 1043</a></span>    <a class="code hl_struct" href="structTValue.html">TValue</a> <a class="code hl_variable" href="structUpVal.html#abc22d06bbcaf3f197af9c6069c562505">value</a>; <span class="comment">/* 值(当关闭时) */</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"><a class="line" href="structUpVal.html#a3e874535cf761992620ec6b3a1ddedd7"> 1044</a></span>  } <a class="code hl_variable" href="structUpVal.html#a3e874535cf761992620ec6b3a1ddedd7">u</a>;</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"><a class="line" href="lobject_8h.html#a420f4f4eeb467ce750d00e5d3a21c109"> 1045</a></span>} <a class="code hl_struct" href="structUpVal.html">UpVal</a>;</div>
</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span> </div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span><span class="comment">/*</span></div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span><span class="comment">** 闭包头部宏</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span><span class="comment">** 所有闭包(Lua和C)共享的头部</span></div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01051" data-start="" data-end="">
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa6994808abcc30f100e21e34b84d3ae0"> 1051</a></span><span class="preprocessor">#define ClosureHeader \</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span><span class="preprocessor">  CommonHeader;       \</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span><span class="preprocessor">  lu_byte nupvalues;  \</span></div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span><span class="preprocessor">  GCObject *gclist</span></div>
</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span> </div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span><span class="comment">/*</span></div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span><span class="comment">** C闭包</span></div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span><span class="comment">**</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span><span class="comment">** C闭包是C函数加上上值</span></div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span><span class="comment">** 上值可以存储任意Lua值,用于在调用间保持状态</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01062" data-start="{" data-end="};">
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"><a class="line" href="structCClosure.html"> 1062</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structCClosure.html">CClosure</a></div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>{</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"><a class="line" href="structCClosure.html#a552c31467816a1fafbd719cf83ff9cba"> 1064</a></span>  <a class="code hl_variable" href="structCClosure.html#a552c31467816a1fafbd719cf83ff9cba">ClosureHeader</a>;     <span class="comment">/* 闭包头部 */</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"><a class="line" href="structCClosure.html#a1ba64febc8e6adc43fdbb82583852000"> 1065</a></span>  <a class="code hl_typedef" href="lua_8h.html#a878b7e392e78661a374cf1c3073029b9">lua_CFunction</a> <a class="code hl_variable" href="structCClosure.html#a1ba64febc8e6adc43fdbb82583852000">f</a>;   <span class="comment">/* C函数指针 */</span></div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"><a class="line" href="structCClosure.html#a75d6bfc66f8ed48b3dd67007be84174f"> 1066</a></span>  <a class="code hl_struct" href="structTValue.html">TValue</a> <a class="code hl_variable" href="structCClosure.html#a75d6bfc66f8ed48b3dd67007be84174f">upvalue</a>[1]; <span class="comment">/* 上值列表(柔性数组) */</span></div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"><a class="line" href="lobject_8h.html#af6216773b23b5805654970e1271e1c7b"> 1067</a></span>} <a class="code hl_struct" href="structCClosure.html">CClosure</a>;</div>
</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span> </div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span><span class="comment">/*</span></div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span><span class="comment">** Lua闭包</span></div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span><span class="comment">**</span></div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span><span class="comment">** Lua闭包是函数原型加上上值</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01074" data-start="{" data-end="};">
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"><a class="line" href="structLClosure.html"> 1074</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structLClosure.html">LClosure</a></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>{</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"><a class="line" href="structLClosure.html#a6014e6d418f56b1ec866c449cab16044"> 1076</a></span>  <a class="code hl_variable" href="structLClosure.html#a6014e6d418f56b1ec866c449cab16044">ClosureHeader</a>;    <span class="comment">/* 闭包头部 */</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"><a class="line" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c"> 1077</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structProto.html">Proto</a> *<a class="code hl_variable" href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">p</a>;  <span class="comment">/* 函数原型 */</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"><a class="line" href="structLClosure.html#a94886e7c7df838f5fab36575b0554682"> 1078</a></span>  <a class="code hl_struct" href="structUpVal.html">UpVal</a> *<a class="code hl_variable" href="structLClosure.html#a94886e7c7df838f5fab36575b0554682">upvals</a>[1]; <span class="comment">/* 上值列表(柔性数组) */</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"><a class="line" href="lobject_8h.html#a17bc5d9d02f31c043f5d144531c58531"> 1079</a></span>} <a class="code hl_struct" href="structLClosure.html">LClosure</a>;</div>
</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span><span class="comment">/*</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="comment">** 闭包联合体</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span><span class="comment">**</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span><span class="comment">** 允许将Closure*转换为CClosure*或LClosure*</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01086" data-start="{" data-end="};">
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"><a class="line" href="unionClosure.html"> 1086</a></span><span class="keyword">typedef</span> <span class="keyword">union </span><a class="code hl_union" href="unionClosure.html">Closure</a></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>{</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"><a class="line" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1"> 1088</a></span>  <a class="code hl_struct" href="structCClosure.html">CClosure</a> <a class="code hl_variable" href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">c</a>; <span class="comment">/* C闭包 */</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"><a class="line" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c"> 1089</a></span>  <a class="code hl_struct" href="structLClosure.html">LClosure</a> <a class="code hl_variable" href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">l</a>; <span class="comment">/* Lua闭包 */</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"><a class="line" href="lobject_8h.html#a7010360932a52c6bb0f85eac9da1d775"> 1090</a></span>} <a class="code hl_union" href="unionClosure.html">Closure</a>;</div>
</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span><span class="comment">/* 获取Lua闭包的原型 */</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"><a class="line" href="lobject_8h.html#a36095400a8ca3ad1e6120f507b421331"> 1093</a></span><span class="preprocessor">#define getproto(o) (clLvalue(o)-&gt;p)</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span> </div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span><span class="comment">** 表(Tables)</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span><span class="comment">**</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span><span class="comment">** Lua的表是关联数组,同时支持:</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span><span class="comment">** - 数组部分:用于整数键的快速访问</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span><span class="comment">** - 哈希部分:用于其他类型的键</span></div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span><span class="comment">*/</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span><span class="comment">/* 表类型标签 */</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"><a class="line" href="lobject_8h.html#afaf24d5b79b9027ad768d023778669df"> 1105</a></span><span class="preprocessor">#define LUA_VTABLE makevariant(LUA_TTABLE, 0)</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span> </div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span><span class="comment">/* 测试是否为表 */</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"><a class="line" href="lobject_8h.html#ac5338f5fe3885d1ee65412e00a44384e"> 1108</a></span><span class="preprocessor">#define ttistable(o) checktag((o), ctb(LUA_VTABLE))</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span> </div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span><span class="comment">/* 获取表,gco2t转换为Table */</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"><a class="line" href="lobject_8h.html#a336a6ce5e8340e6de133ec249cf47ebf"> 1111</a></span><span class="preprocessor">#define hvalue(o) check_exp(ttistable(o), gco2t(val_(o).gc))</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span> </div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span><span class="comment">/* 设置表值 */</span></div>
<div class="foldopen" id="foldopen01114" data-start="" data-end="">
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"><a class="line" href="lobject_8h.html#ab9379699ac579d54410e3542f061bbad"> 1114</a></span><span class="preprocessor">#define sethvalue(L, obj, x)     \</span></div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span><span class="preprocessor">  {                              \</span></div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span><span class="preprocessor">    TValue *io = (obj);          \</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span><span class="preprocessor">    Table *x_ = (x);             \</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span><span class="preprocessor">    val_(io).gc = obj2gco(x_);   \</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span><span class="preprocessor">    settt_(io, ctb(LUA_VTABLE)); \</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span><span class="preprocessor">    checkliveness(L, io);        \</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span> </div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span><span class="comment">/* 设置栈上的表 */</span></div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"><a class="line" href="lobject_8h.html#aea789832f6c549f64cb3903216a7aeac"> 1124</a></span><span class="preprocessor">#define sethvalue2s(L, o, h) sethvalue(L, s2v(o), h)</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span> </div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span><span class="comment">/*</span></div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span><span class="comment">** 哈希表的节点</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span><span class="comment">**</span></div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span><span class="comment">** 一对TValue(键-值对)加上一个next字段用于链接冲突条目</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span><span class="comment">**</span></div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span><span class="comment">** 键的字段(key_tt和key_val)的分布不形成正规的TValue,</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span><span class="comment">** 这允许Node在4字节和8字节对齐中都有更小的大小</span></div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01136" data-start="{" data-end="};">
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"><a class="line" href="unionNode.html"> 1136</a></span><span class="keyword">typedef</span> <span class="keyword">union </span><a class="code hl_union" href="unionNode.html">Node</a></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>{</div>
<div class="foldopen" id="foldopen01138" data-start="{" data-end="};">
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"><a class="line" href="structNode_1_1NodeKey.html"> 1138</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structNode_1_1NodeKey.html">NodeKey</a></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>  {</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"><a class="line" href="structNode_1_1NodeKey.html#ad7940273d82fb786627ede300d3e7b46"> 1140</a></span>    <a class="code hl_variable" href="structNode_1_1NodeKey.html#ad7940273d82fb786627ede300d3e7b46">TValuefields</a>;   <span class="comment">/* 值的字段 */</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"><a class="line" href="structNode_1_1NodeKey.html#afdbcc530a117bbf2b90c4f35ad257110"> 1141</a></span>    <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structNode_1_1NodeKey.html#afdbcc530a117bbf2b90c4f35ad257110">key_tt</a>; <span class="comment">/* 键类型 */</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"><a class="line" href="structNode_1_1NodeKey.html#ace566bb6e78ae2d0cdb2a3c6da79cfb6"> 1142</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="structNode_1_1NodeKey.html#ace566bb6e78ae2d0cdb2a3c6da79cfb6">next</a>;       <span class="comment">/* 链接冲突条目(索引,不是指针) */</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"><a class="line" href="structNode_1_1NodeKey.html#abac9092163e037bc154ad58f454fbca9"> 1143</a></span>    <a class="code hl_union" href="unionValue.html">Value</a> <a class="code hl_variable" href="structNode_1_1NodeKey.html#abac9092163e037bc154ad58f454fbca9">key_val</a>;  <span class="comment">/* 键值 */</span></div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"><a class="line" href="unionNode.html#a8f1edb039f176596b777da8f537c1071"> 1144</a></span>  } <a class="code hl_variable" href="unionNode.html#a8f1edb039f176596b777da8f537c1071">u</a>;</div>
</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"><a class="line" href="unionNode.html#a79460c331faee0ef988637e92749e866"> 1145</a></span>  <a class="code hl_struct" href="structTValue.html">TValue</a> <a class="code hl_variable" href="unionNode.html#a79460c331faee0ef988637e92749e866">i_val</a>; <span class="comment">/* 直接访问节点值作为正规TValue */</span></div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"><a class="line" href="lobject_8h.html#a945b262d2678b7e3ca2f38381fdaad4d"> 1146</a></span>} <a class="code hl_union" href="unionNode.html">Node</a>;</div>
</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span> </div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span><span class="comment">/*</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span><span class="comment">** 将值复制到键中</span></div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span><span class="comment">** 注意:键的布局与TValue不同,需要分别复制字段</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01152" data-start="" data-end="">
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"><a class="line" href="lobject_8h.html#a04ba97a7f79b808cd8344ca22b43f882"> 1152</a></span><span class="preprocessor">#define setnodekey(node, obj)    \</span></div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span><span class="preprocessor">  {                              \</span></div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span><span class="preprocessor">    Node *n_ = (node);           \</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span><span class="preprocessor">    const TValue *io_ = (obj);   \</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span><span class="preprocessor">    n_-&gt;u.key_val = io_-&gt;value_; \</span></div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span><span class="preprocessor">    n_-&gt;u.key_tt = io_-&gt;tt_;     \</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span> </div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span><span class="comment">/*</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span><span class="comment">** 从键复制值到TValue</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span><span class="comment">** 重新组装分散的键字段为正规TValue</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01164" data-start="" data-end="">
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa7b8fdb54ee8ce0235270f7d0b41e430"> 1164</a></span><span class="preprocessor">#define getnodekey(L, obj, node) \</span></div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span><span class="preprocessor">  {                              \</span></div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span><span class="preprocessor">    TValue *io_ = (obj);         \</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span><span class="preprocessor">    const Node *n_ = (node);     \</span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span><span class="preprocessor">    io_-&gt;value_ = n_-&gt;u.key_val; \</span></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span><span class="preprocessor">    io_-&gt;tt_ = n_-&gt;u.key_tt;     \</span></div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span><span class="preprocessor">    checkliveness(L, io_);       \</span></div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span> </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span><span class="comment">/*</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span><span class="comment">** 表结构</span></div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span><span class="comment">**</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span><span class="comment">** Lua的表使用混合存储策略:</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span><span class="comment">** - array: 数组部分,用于整数键1..asize</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="comment">** - node: 哈希部分,用于其他键</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01180" data-start="{" data-end="};">
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"><a class="line" href="structTable.html"> 1180</a></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="structTable.html">Table</a></div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>{</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"><a class="line" href="structTable.html#aeceeffe77c9ef26aeca656183fc50110"> 1182</a></span>  <a class="code hl_variable" href="structTable.html#aeceeffe77c9ef26aeca656183fc50110">CommonHeader</a>;            <span class="comment">/* GC头部 */</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"><a class="line" href="structTable.html#a643cf38ebbab9e5af99ff8a980ffbae5"> 1183</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structTable.html#a643cf38ebbab9e5af99ff8a980ffbae5">flags</a>;           <span class="comment">/* 1&lt;&lt;p表示标签方法(p)不存在(优化) */</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"><a class="line" href="structTable.html#aed057d880ebe0f38f65e626f646adf6a"> 1184</a></span>  <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_variable" href="structTable.html#aed057d880ebe0f38f65e626f646adf6a">lsizenode</a>;       <span class="comment">/* node数组槽位数的log2 */</span></div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"><a class="line" href="structTable.html#ab4290d33cf4cc8c47868f8640300970a"> 1185</a></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="structTable.html#ab4290d33cf4cc8c47868f8640300970a">asize</a>;      <span class="comment">/* array数组的槽位数 */</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"><a class="line" href="structTable.html#ad22ad0fad7ad6116de3dcc89fba94747"> 1186</a></span>  <a class="code hl_union" href="unionValue.html">Value</a> *<a class="code hl_variable" href="structTable.html#ad22ad0fad7ad6116de3dcc89fba94747">array</a>;            <span class="comment">/* 数组部分 */</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"><a class="line" href="structTable.html#a519f179c707cb4e93bb66d09151c89e5"> 1187</a></span>  <a class="code hl_union" href="unionNode.html">Node</a> *<a class="code hl_variable" href="structTable.html#a519f179c707cb4e93bb66d09151c89e5">node</a>;              <span class="comment">/* 哈希部分 */</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"><a class="line" href="structTable.html#a99c20fa696fb6a4e89890efa3819ebdc"> 1188</a></span>  <span class="keyword">struct </span><a class="code hl_struct" href="structTable.html">Table</a> *<a class="code hl_variable" href="structTable.html#a99c20fa696fb6a4e89890efa3819ebdc">metatable</a>; <span class="comment">/* 元表 */</span></div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"><a class="line" href="structTable.html#a1b6f3d76efed2011a36ee7c78f65aa70"> 1189</a></span>  <a class="code hl_struct" href="structGCObject.html">GCObject</a> *<a class="code hl_variable" href="structTable.html#a1b6f3d76efed2011a36ee7c78f65aa70">gclist</a>;        <span class="comment">/* GC链表 */</span></div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"><a class="line" href="lobject_8h.html#aaa5713bb2ecdf81c430009179b806232"> 1190</a></span>} <a class="code hl_struct" href="structTable.html">Table</a>;</div>
</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span> </div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span><span class="comment">/*</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span><span class="comment">** 操作节点中键的宏</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span><span class="comment">*/</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span><span class="comment">/* 获取节点的键类型 */</span></div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"><a class="line" href="lobject_8h.html#af89f4367b6adf6c6708feae2667736cb"> 1199</a></span><span class="preprocessor">#define keytt(node) ((node)-&gt;u.key_tt)</span></div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span><span class="comment">/* 获取节点的键值 */</span></div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"><a class="line" href="lobject_8h.html#ac2aa0ae587e918878c9c310734d81d56"> 1201</a></span><span class="preprocessor">#define keyval(node) ((node)-&gt;u.key_val)</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span> </div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span><span class="comment">/* 测试键是否为nil */</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"><a class="line" href="lobject_8h.html#a64e2e5b8ce53a1dc7a528b13947d7ff3"> 1204</a></span><span class="preprocessor">#define keyisnil(node) (keytt(node) == LUA_TNIL)</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span><span class="comment">/* 测试键是否为整数 */</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"><a class="line" href="lobject_8h.html#affab919da1b667cc1a98f2bd040aa94e"> 1206</a></span><span class="preprocessor">#define keyisinteger(node) (keytt(node) == LUA_VNUMINT)</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span><span class="comment">/* 获取整数键的值 */</span></div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"><a class="line" href="lobject_8h.html#a03d51823d7893e729288cff396e16120"> 1208</a></span><span class="preprocessor">#define keyival(node) (keyval(node).i)</span></div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span><span class="comment">/* 测试键是否为短字符串 */</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"><a class="line" href="lobject_8h.html#a06a6d0eeb65723526d00bdf71402d518"> 1210</a></span><span class="preprocessor">#define keyisshrstr(node) (keytt(node) == ctb(LUA_VSHRSTR))</span></div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span><span class="comment">/* 获取字符串键的值,gco2ts转换为TString */</span></div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"><a class="line" href="lobject_8h.html#af0d29f0c2bdfa023abc9e7a0d34e8e24"> 1212</a></span><span class="preprocessor">#define keystrval(node) (gco2ts(keyval(node).gc))</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span> </div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span><span class="comment">/* 将键设为nil */</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"><a class="line" href="lobject_8h.html#abc95de76b69ef4abed8c40959657208a"> 1215</a></span><span class="preprocessor">#define setnilkey(node) (keytt(node) = LUA_TNIL)</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span> </div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span><span class="comment">/* 测试键是否为可回收类型 */</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"><a class="line" href="lobject_8h.html#ad5d0afe3e47112e0136e0d6afb6c4536"> 1218</a></span><span class="preprocessor">#define keyiscollectable(n) (keytt(n) &amp; BIT_ISCOLLECTABLE)</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span> </div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span><span class="comment">/* 获取键的GC对象 */</span></div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"><a class="line" href="lobject_8h.html#ac3dbc3b85a58d872c002e6cbea675bac"> 1221</a></span><span class="preprocessor">#define gckey(n) (keyval(n).gc)</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span><span class="comment">/* 获取键的GC对象(如果可回收),否则NULL */</span></div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"><a class="line" href="lobject_8h.html#a228a192019c3bf44b6027d8f4a38c904"> 1223</a></span><span class="preprocessor">#define gckeyN(n) (keyiscollectable(n) ? gckey(n) : NULL)</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span> </div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span><span class="comment">/*</span></div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span><span class="comment">** 表中的死键</span></div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span><span class="comment">**</span></div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span><span class="comment">** 死键保持LUA_TDEADKEY标签但保留原始gcvalue</span></div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span><span class="comment">** 这将它们与常规键区分开,但允许在特殊搜索时找到它们</span></div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span><span class="comment">** (next需要这个来找到遍历期间从表中删除的键)</span></div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span><span class="comment">*/</span></div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa7815bab40102b09bfef47927defc96a"> 1232</a></span><span class="preprocessor">#define setdeadkey(node) (keytt(node) = LUA_TDEADKEY)</span></div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"><a class="line" href="lobject_8h.html#acf2f2261c3460b1213085871ad4c3471"> 1233</a></span><span class="preprocessor">#define keyisdead(node) (keytt(node) == LUA_TDEADKEY)</span></div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span> </div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span><span class="comment">** 哈希辅助宏</span></div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span><span class="comment">*/</span></div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span> </div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span><span class="comment">/*</span></div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span><span class="comment">** 哈希的模运算(大小总是2的幂)</span></div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span><span class="comment">**</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span><span class="comment">** 使用位运算优化取模:对于2的幂,s % size == s &amp; (size-1)</span></div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span><span class="comment">** check_exp确保size确实是2的幂</span></div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01246" data-start="" data-end="">
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"><a class="line" href="lobject_8h.html#a528d710ddad324002e3cb47992740b6a"> 1246</a></span><span class="preprocessor">#define lmod(s, size) \</span></div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span><span class="preprocessor">  (check_exp((size &amp; (size - 1)) == 0, (cast_uint(s) &amp; cast_uint((size) - 1))))</span></div>
</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span> </div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span><span class="comment">/* 2的x次幂 */</span></div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"><a class="line" href="lobject_8h.html#aa341ef742b199e1c29a19d2c490ad74e"> 1250</a></span><span class="preprocessor">#define twoto(x) (1u &lt;&lt; (x))</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span><span class="comment">/* 获取哈希表节点数组的大小 */</span></div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"><a class="line" href="lobject_8h.html#a2fbf715e78eaa889ed0fb9d4514e736a"> 1252</a></span><span class="preprocessor">#define sizenode(t) (twoto((t)-&gt;lsizenode))</span></div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span> </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span><span class="comment">/*</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span><span class="comment">** luaO_utf8esc函数缓冲区的大小</span></div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span><span class="comment">** UTF-8编码最多需要6字节,加上终止符和一些余量</span></div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span><span class="comment">*/</span></div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"><a class="line" href="lobject_8h.html#ae0741e99030a23e3c24b0eb828fbbe4b"> 1258</a></span><span class="preprocessor">#define UTF8BUFFSZ 8</span></div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span> </div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span><span class="comment">/*</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span><span class="comment">** 正确调用luaO_pushvfstring的宏</span></div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span><span class="comment">**</span></div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span><span class="comment">** 这个宏处理可变参数:</span></div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span><span class="comment">** 1. 使用va_start初始化参数列表</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span><span class="comment">** 2. 调用luaO_pushvfstring</span></div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span><span class="comment">** 3. 使用va_end清理</span></div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span><span class="comment">** 4. 如果返回NULL(内存错误),抛出异常</span></div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01269" data-start="" data-end="">
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"><a class="line" href="lobject_8h.html#ac8bc7128a0ba59c91734c58e8ed5572d"> 1269</a></span><span class="preprocessor">#define pushvfstring(L, argp, fmt, msg)               \</span></div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span><span class="preprocessor">  {                                                   \</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span><span class="preprocessor">    va_start(argp, fmt);                              \</span></div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span><span class="preprocessor">    msg = luaO_pushvfstring(L, fmt, argp);            \</span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span><span class="preprocessor">    va_end(argp);                                     \</span></div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span><span class="preprocessor">    if (msg == NULL)                                  \</span></div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span><span class="preprocessor">      luaD_throw(L, LUA_ERRMEM); </span><span class="comment">/* 只在va_end之后 */</span><span class="preprocessor"> \</span></div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span><span class="preprocessor">  }</span></div>
</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span> </div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span><span class="comment">/* ============================================================================</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span><span class="comment">** 函数声明</span></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span><span class="comment">**</span></div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span><span class="comment">** LUAI_FUNC标记为Lua内部函数(通常是静态或有限可见性)</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span><span class="comment">**</span></div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span><span class="comment">** 这些函数在lobject.c中实现,提供对象操作的核心功能</span></div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span><span class="comment">*/</span></div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span> </div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span><span class="comment">/*</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span><span class="comment">** UTF-8转义序列</span></div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span><span class="comment">** buff: 输出缓冲区, x: Unicode码点</span></div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span><span class="comment">** 返回: 写入的字节数</span></div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span><span class="comment">*/</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keywordtype">int</span> <a class="code hl_function" href="lobject_8h.html#a88804f6fb1465815836b0f7f8422963a">luaO_utf8esc</a>(<span class="keywordtype">char</span> *buff, <a class="code hl_typedef" href="llimits_8h.html#abeb00a444eb1dc99a4a2baee15bd898a">l_uint32</a> x);</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span> </div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span><span class="comment">/*</span></div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span><span class="comment">** 计算不小于x的最小的2的幂的指数</span></div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span><span class="comment">** 例如: x=5返回3 (因为2^3=8&gt;=5)</span></div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span><span class="comment">*/</span></div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_function" href="lobject_8h.html#a86e18e1d1ffe3936a7ae560949f38bf6">luaO_ceillog2</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x);</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span> </div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span><span class="comment">/*</span></div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span><span class="comment">** 编码参数p</span></div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span><span class="comment">** 用于压缩存储某些参数</span></div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span><span class="comment">*/</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_function" href="lobject_8h.html#a7192b29182ab427925ba216f29045929">luaO_codeparam</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p);</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span> </div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span><span class="comment">/*</span></div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span><span class="comment">** 应用编码参数p到值x</span></div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span><span class="comment">** 解压缩编码的参数</span></div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span><span class="comment">*/</span></div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <a class="code hl_typedef" href="llimits_8h.html#a24fc195087e262c99a4cf0f9b346a684">l_mem</a> <a class="code hl_function" href="lobject_8h.html#a3e8492fa8195572b47d5534f486d0481">luaO_applyparam</a>(<a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> p, <a class="code hl_typedef" href="llimits_8h.html#a24fc195087e262c99a4cf0f9b346a684">l_mem</a> x);</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span> </div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span><span class="comment">/*</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span><span class="comment">** 原始算术运算(不触发元方法)</span></div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span><span class="comment">** L: Lua状态, op: 操作符, p1,p2: 操作数, res: 结果</span></div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span><span class="comment">** 返回: 1成功, 0失败</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span><span class="comment">*/</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keywordtype">int</span> <a class="code hl_function" href="lobject_8h.html#a5ea49a125e2848e4303dc10929302865">luaO_rawarith</a>(<a class="code hl_struct" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> op, <span class="keyword">const</span> <a class="code hl_struct" href="structTValue.html">TValue</a> *p1,</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>                            <span class="keyword">const</span> <a class="code hl_struct" href="structTValue.html">TValue</a> *p2, <a class="code hl_struct" href="structTValue.html">TValue</a> *res);</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span> </div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span><span class="comment">/*</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span><span class="comment">** 算术运算(可能触发元方法)</span></div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span><span class="comment">** L: Lua状态, op: 操作符, p1,p2: 操作数, res: 结果栈位置</span></div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span><span class="comment">*/</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keywordtype">void</span> <a class="code hl_function" href="lobject_8h.html#afb09097c7bc4723a274863f6a811edf5">luaO_arith</a>(<a class="code hl_struct" href="structlua__State.html">lua_State</a> *L, <span class="keywordtype">int</span> op, <span class="keyword">const</span> <a class="code hl_struct" href="structTValue.html">TValue</a> *p1,</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>                          <span class="keyword">const</span> <a class="code hl_struct" href="structTValue.html">TValue</a> *p2, <a class="code hl_typedef" href="lobject_8h.html#a75170ac0f54a6beb06b8a7f9db47d073">StkId</a> res);</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span> </div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span><span class="comment">/*</span></div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span><span class="comment">** 字符串转数字</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span><span class="comment">** s: 字符串, o: 输出TValue</span></div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span><span class="comment">** 返回: 转换的字符数(0表示失败)</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span><span class="comment">*/</span></div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keywordtype">size_t</span> <a class="code hl_function" href="lobject_8h.html#ab56d8211e48dc3c70c3fa21d92d009af">luaO_str2num</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <a class="code hl_struct" href="structTValue.html">TValue</a> *o);</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span> </div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span><span class="comment">/*</span></div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span><span class="comment">** 对象转字符串(到缓冲区)</span></div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span><span class="comment">** obj: 对象, buff: 缓冲区</span></div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span><span class="comment">** 返回: 字符串长度</span></div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span><span class="comment">*/</span></div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keywordtype">unsigned</span> <a class="code hl_function" href="lobject_8h.html#ab9ec50dab06ea554796a8faf9789c60a">luaO_tostringbuff</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structTValue.html">TValue</a> *obj, <span class="keywordtype">char</span> *buff);</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span> </div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span><span class="comment">/*</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span><span class="comment">** 十六进制字符的值</span></div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span><span class="comment">** c: 字符(&#39;0&#39;-&#39;9&#39;,&#39;a&#39;-&#39;f&#39;,&#39;A&#39;-&#39;F&#39;)</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span><span class="comment">** 返回: 0-15的值</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span><span class="comment">*/</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <a class="code hl_typedef" href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a> <a class="code hl_function" href="lobject_8h.html#abbc83c2712bceea2ebd8bb05c6ca519f">luaO_hexavalue</a>(<span class="keywordtype">int</span> c);</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span> </div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span><span class="comment">/*</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span><span class="comment">** 对象转字符串(就地转换TValue)</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span><span class="comment">** L: Lua状态, obj: 对象</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span><span class="comment">** 副作用: obj可能被转换为字符串</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span><span class="comment">*/</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keywordtype">void</span> <a class="code hl_function" href="lobject_8h.html#a007d2c6293fee953f3af21f60f8133ba">luaO_tostring</a>(<a class="code hl_struct" href="structlua__State.html">lua_State</a> *L, <a class="code hl_struct" href="structTValue.html">TValue</a> *obj);</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span> </div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span><span class="comment">/*</span></div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span><span class="comment">** 格式化字符串(可变参数版本)</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span><span class="comment">** L: Lua状态, fmt: 格式字符串, argp: 参数列表</span></div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span><span class="comment">** 返回: 结果字符串(压入栈),NULL表示内存错误</span></div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span><span class="comment">*/</span></div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_function" href="lobject_8h.html#ad2cbc19197e7919389c664165c287d7b">luaO_pushvfstring</a>(<a class="code hl_struct" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt,</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>                                        va_list argp);</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span> </div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span><span class="comment">/*</span></div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span><span class="comment">** 格式化字符串</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span><span class="comment">** L: Lua状态, fmt: 格式字符串, ...: 可变参数</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span><span class="comment">** 返回: 结果字符串(压入栈)</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span><span class="comment">*/</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code hl_function" href="lobject_8h.html#a3f910c67f694b68c8edea330a1be6e11">luaO_pushfstring</a>(<a class="code hl_struct" href="structlua__State.html">lua_State</a> *L, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...);</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span> </div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span><span class="comment">/*</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span><span class="comment">** 生成chunk标识符</span></div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span><span class="comment">** out: 输出缓冲区, source: 源字符串, srclen: 源长度</span></div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span><span class="comment">** 副作用: 在out中生成适合显示的chunk名称</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span><span class="comment">*/</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span><a class="code hl_define" href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a> <span class="keywordtype">void</span> <a class="code hl_function" href="lobject_8h.html#aa83e4edb8b62b06537c43c2ec8b97221">luaO_chunkid</a>(<span class="keywordtype">char</span> *out, <span class="keyword">const</span> <span class="keywordtype">char</span> *source, <span class="keywordtype">size_t</span> srclen);</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span> </div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span> </div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span><span class="comment">/*</span></div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span><span class="comment">** 文件总结</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span><span class="comment">**</span></div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span><span class="comment">** lobject.h 是Lua虚拟机的核心头文件,定义了Lua中所有值的内部表示。</span></div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span><span class="comment">**</span></div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span><span class="comment">** 核心概念总结:</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span><span class="comment">**</span></div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span><span class="comment">** 1. **带标签的值(Tagged Value - TValue)**</span></div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span><span class="comment">**    - Lua使用统一的TValue结构表示所有类型的值</span></div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span><span class="comment">**    - 包含Value联合体(存储实际数据)和tt_字节(类型标签)</span></div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span><span class="comment">**    - 类型标签编码:基础类型(位0-3)、变体(位4-5)、GC标记(位6)</span></div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span><span class="comment">**</span></div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span><span class="comment">** 2. **类型系统**</span></div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span><span class="comment">**    - 基本类型:nil, boolean, number, string, table, function, userdata, thread</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span><span class="comment">**    - 每种类型可能有多个变体(如整数vs浮点数,短字符串vs长字符串)</span></div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span><span class="comment">**    - 使用位运算高效地编码和检查类型信息</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span><span class="comment">**</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span><span class="comment">** 3. **垃圾回收(GC)**</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span><span class="comment">**    - 可回收对象都有CommonHeader(next, tt, marked)</span></div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span><span class="comment">**    - 使用可回收标记位(第6位)快速判断是否需要GC</span></div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span><span class="comment">**    - 支持三色标记算法(marked字段)</span></div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span><span class="comment">**</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="comment">** 4. **内存优化**</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span><span class="comment">**    - 使用联合体节省内存(一个值同时只是一种类型)</span></div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span><span class="comment">**    - 字符串内部化(短字符串)减少重复</span></div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span><span class="comment">**    - 表的混合存储(数组+哈希)优化访问效率</span></div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span><span class="comment">**</span></div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span><span class="comment">** 5. **高级特性支持**</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span><span class="comment">**    - 闭包通过UpVal实现,支持开放和关闭状态</span></div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span><span class="comment">**    - 协程通过独立的栈和状态实现</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span><span class="comment">**    - 元表机制允许自定义类型行为</span></div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span><span class="comment">**    - to-be-closed变量支持确定性资源清理</span></div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span><span class="comment">**</span></div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span><span class="comment">** 6. **宏设计模式**</span></div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span><span class="comment">**    - 大量使用宏提供类型安全的访问接口</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span><span class="comment">**    - 宏在编译时展开,零运行时开销</span></div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span><span class="comment">**    - check_exp宏在调试版本提供运行时检查</span></div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span><span class="comment">**</span></div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span><span class="comment">** 7. **API设计原则**</span></div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span><span class="comment">**    - 提供多层次的访问:raw(无检查)、带检查、高级封装</span></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span><span class="comment">**    - 使用命名约定区分不同用途(如setobj2s, setobj2t)</span></div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span><span class="comment">**    - 考虑未来扩展性(如不同的赋值宏可能有不同的写屏障)</span></div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span><span class="comment">**</span></div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span><span class="comment">** 阅读建议:</span></div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span><span class="comment">** - 首先理解TValue和类型标签系统</span></div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span><span class="comment">** - 然后逐个类型深入(从简单到复杂:nil -&gt; boolean -&gt; number -&gt; ...)</span></div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span><span class="comment">** - 注意各种宏的命名模式和设计意图</span></div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span><span class="comment">** - 结合lobject.c的实现代码加深理解</span></div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span><span class="comment">**</span></div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span><span class="comment">** 这个文件体现了Lua实现的核心设计哲学:</span></div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span><span class="comment">** - 简洁高效的数据表示</span></div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span><span class="comment">** - 统一的类型系统</span></div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span><span class="comment">** - 精心设计的内存管理</span></div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span><span class="comment">** - 通过C宏实现零成本抽象</span></div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span><span class="comment">** ============================================================================</span></div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span><span class="comment">*/</span></div>
<div class="ttc" id="allimits_8h_html"><div class="ttname"><a href="llimits_8h.html">llimits.h</a></div></div>
<div class="ttc" id="allimits_8h_html_a24fc195087e262c99a4cf0f9b346a684"><div class="ttname"><a href="llimits_8h.html#a24fc195087e262c99a4cf0f9b346a684">l_mem</a></div><div class="ttdeci">long l_mem</div><div class="ttdef"><b>Definition</b> llimits.h:109</div></div>
<div class="ttc" id="allimits_8h_html_a3f43b35a70c93f2cfde1db42a5a24f1e"><div class="ttname"><a href="llimits_8h.html#a3f43b35a70c93f2cfde1db42a5a24f1e">LUAI_FUNC</a></div><div class="ttdeci">#define LUAI_FUNC</div><div class="ttdef"><b>Definition</b> llimits.h:866</div></div>
<div class="ttc" id="allimits_8h_html_aab58a246c9e0a85c4c2ed0fd8d6724bb"><div class="ttname"><a href="llimits_8h.html#aab58a246c9e0a85c4c2ed0fd8d6724bb">ls_byte</a></div><div class="ttdeci">signed char ls_byte</div><div class="ttdef"><b>Definition</b> llimits.h:143</div></div>
<div class="ttc" id="allimits_8h_html_abeb00a444eb1dc99a4a2baee15bd898a"><div class="ttname"><a href="llimits_8h.html#abeb00a444eb1dc99a4a2baee15bd898a">l_uint32</a></div><div class="ttdeci">unsigned long l_uint32</div><div class="ttdef"><b>Definition</b> llimits.h:629</div></div>
<div class="ttc" id="allimits_8h_html_ae1fe9ac10d9803bd1d7bdf30b18bad68"><div class="ttname"><a href="llimits_8h.html#ae1fe9ac10d9803bd1d7bdf30b18bad68">lu_byte</a></div><div class="ttdeci">unsigned char lu_byte</div><div class="ttdef"><b>Definition</b> llimits.h:142</div></div>
<div class="ttc" id="alobject_8h_html_a007d2c6293fee953f3af21f60f8133ba"><div class="ttname"><a href="lobject_8h.html#a007d2c6293fee953f3af21f60f8133ba">luaO_tostring</a></div><div class="ttdeci">LUAI_FUNC void luaO_tostring(lua_State *L, TValue *obj)</div><div class="ttdef"><b>Definition</b> lobject.c:1283</div></div>
<div class="ttc" id="alobject_8h_html_a3e8492fa8195572b47d5534f486d0481"><div class="ttname"><a href="lobject_8h.html#a3e8492fa8195572b47d5534f486d0481">luaO_applyparam</a></div><div class="ttdeci">LUAI_FUNC l_mem luaO_applyparam(lu_byte p, l_mem x)</div><div class="ttdef"><b>Definition</b> lobject.c:243</div></div>
<div class="ttc" id="alobject_8h_html_a3f910c67f694b68c8edea330a1be6e11"><div class="ttname"><a href="lobject_8h.html#a3f910c67f694b68c8edea330a1be6e11">luaO_pushfstring</a></div><div class="ttdeci">LUAI_FUNC const char * luaO_pushfstring(lua_State *L, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> lobject.c:1714</div></div>
<div class="ttc" id="alobject_8h_html_a5ea49a125e2848e4303dc10929302865"><div class="ttname"><a href="lobject_8h.html#a5ea49a125e2848e4303dc10929302865">luaO_rawarith</a></div><div class="ttdeci">LUAI_FUNC int luaO_rawarith(lua_State *L, int op, const TValue *p1, const TValue *p2, TValue *res)</div><div class="ttdef"><b>Definition</b> lobject.c:449</div></div>
<div class="ttc" id="alobject_8h_html_a7192b29182ab427925ba216f29045929"><div class="ttname"><a href="lobject_8h.html#a7192b29182ab427925ba216f29045929">luaO_codeparam</a></div><div class="ttdeci">LUAI_FUNC lu_byte luaO_codeparam(unsigned int p)</div><div class="ttdef"><b>Definition</b> lobject.c:178</div></div>
<div class="ttc" id="alobject_8h_html_a75170ac0f54a6beb06b8a7f9db47d073"><div class="ttname"><a href="lobject_8h.html#a75170ac0f54a6beb06b8a7f9db47d073">StkId</a></div><div class="ttdeci">StackValue * StkId</div><div class="ttdef"><b>Definition</b> lobject.h:274</div></div>
<div class="ttc" id="alobject_8h_html_a86e18e1d1ffe3936a7ae560949f38bf6"><div class="ttname"><a href="lobject_8h.html#a86e18e1d1ffe3936a7ae560949f38bf6">luaO_ceillog2</a></div><div class="ttdeci">LUAI_FUNC lu_byte luaO_ceillog2(unsigned int x)</div><div class="ttdef"><b>Definition</b> lobject.c:111</div></div>
<div class="ttc" id="alobject_8h_html_a88804f6fb1465815836b0f7f8422963a"><div class="ttname"><a href="lobject_8h.html#a88804f6fb1465815836b0f7f8422963a">luaO_utf8esc</a></div><div class="ttdeci">LUAI_FUNC int luaO_utf8esc(char *buff, l_uint32 x)</div><div class="ttdef"><b>Definition</b> lobject.c:1109</div></div>
<div class="ttc" id="alobject_8h_html_aa81d2e7f7263ef29946852d4966a192e"><div class="ttname"><a href="lobject_8h.html#aa81d2e7f7263ef29946852d4966a192e">Instruction</a></div><div class="ttdeci">l_uint32 Instruction</div><div class="ttdef"><b>Definition</b> lobject.h:842</div></div>
<div class="ttc" id="alobject_8h_html_aa83e4edb8b62b06537c43c2ec8b97221"><div class="ttname"><a href="lobject_8h.html#aa83e4edb8b62b06537c43c2ec8b97221">luaO_chunkid</a></div><div class="ttdeci">LUAI_FUNC void luaO_chunkid(char *out, const char *source, size_t srclen)</div><div class="ttdef"><b>Definition</b> lobject.c:1763</div></div>
<div class="ttc" id="alobject_8h_html_ab56d8211e48dc3c70c3fa21d92d009af"><div class="ttname"><a href="lobject_8h.html#ab56d8211e48dc3c70c3fa21d92d009af">luaO_str2num</a></div><div class="ttdeci">LUAI_FUNC size_t luaO_str2num(const char *s, TValue *o)</div><div class="ttdef"><b>Definition</b> lobject.c:1051</div></div>
<div class="ttc" id="alobject_8h_html_ab9ec50dab06ea554796a8faf9789c60a"><div class="ttname"><a href="lobject_8h.html#ab9ec50dab06ea554796a8faf9789c60a">luaO_tostringbuff</a></div><div class="ttdeci">LUAI_FUNC unsigned luaO_tostringbuff(const TValue *obj, char *buff)</div><div class="ttdef"><b>Definition</b> lobject.c:1247</div></div>
<div class="ttc" id="alobject_8h_html_abbc83c2712bceea2ebd8bb05c6ca519f"><div class="ttname"><a href="lobject_8h.html#abbc83c2712bceea2ebd8bb05c6ca519f">luaO_hexavalue</a></div><div class="ttdeci">LUAI_FUNC lu_byte luaO_hexavalue(int c)</div><div class="ttdef"><b>Definition</b> lobject.c:586</div></div>
<div class="ttc" id="alobject_8h_html_ad2cbc19197e7919389c664165c287d7b"><div class="ttname"><a href="lobject_8h.html#ad2cbc19197e7919389c664165c287d7b">luaO_pushvfstring</a></div><div class="ttdeci">LUAI_FUNC const char * luaO_pushvfstring(lua_State *L, const char *fmt, va_list argp)</div><div class="ttdef"><b>Definition</b> lobject.c:1593</div></div>
<div class="ttc" id="alobject_8h_html_afb09097c7bc4723a274863f6a811edf5"><div class="ttname"><a href="lobject_8h.html#afb09097c7bc4723a274863f6a811edf5">luaO_arith</a></div><div class="ttdeci">LUAI_FUNC void luaO_arith(lua_State *L, int op, const TValue *p1, const TValue *p2, StkId res)</div><div class="ttdef"><b>Definition</b> lobject.c:548</div></div>
<div class="ttc" id="alua_8h_html"><div class="ttname"><a href="lua_8h.html">lua.h</a></div></div>
<div class="ttc" id="alua_8h_html_a2ba24df8972a4a52ebd3517c62e0830d"><div class="ttname"><a href="lua_8h.html#a2ba24df8972a4a52ebd3517c62e0830d">lua_Alloc</a></div><div class="ttdeci">void *(* lua_Alloc)(void *ud, void *ptr, size_t osize, size_t nsize)</div><div class="ttdef"><b>Definition</b> lua.h:409</div></div>
<div class="ttc" id="alua_8h_html_a362144baa0cfb14dc38fd21438053d73"><div class="ttname"><a href="lua_8h.html#a362144baa0cfb14dc38fd21438053d73">lua_Integer</a></div><div class="ttdeci">LUA_INTEGER lua_Integer</div><div class="ttdef"><b>Definition</b> lua.h:254</div></div>
<div class="ttc" id="alua_8h_html_a878b7e392e78661a374cf1c3073029b9"><div class="ttname"><a href="lua_8h.html#a878b7e392e78661a374cf1c3073029b9">lua_CFunction</a></div><div class="ttdeci">int(* lua_CFunction)(lua_State *L)</div><div class="ttdef"><b>Definition</b> lua.h:312</div></div>
<div class="ttc" id="alua_8h_html_af0a6ed3b852d680769cfc410a0672172"><div class="ttname"><a href="lua_8h.html#af0a6ed3b852d680769cfc410a0672172">lua_Number</a></div><div class="ttdeci">LUA_NUMBER lua_Number</div><div class="ttdef"><b>Definition</b> lua.h:246</div></div>
<div class="ttc" id="astructAbsLineInfo_html"><div class="ttname"><a href="structAbsLineInfo.html">AbsLineInfo</a></div><div class="ttdef"><b>Definition</b> lobject.h:886</div></div>
<div class="ttc" id="astructAbsLineInfo_html_aadedc41698239b3660609c2d2319f46f"><div class="ttname"><a href="structAbsLineInfo.html#aadedc41698239b3660609c2d2319f46f">AbsLineInfo::pc</a></div><div class="ttdeci">int pc</div><div class="ttdef"><b>Definition</b> lobject.h:887</div></div>
<div class="ttc" id="astructAbsLineInfo_html_aeaae3dad0ef96232c843f79d378e6272"><div class="ttname"><a href="structAbsLineInfo.html#aeaae3dad0ef96232c843f79d378e6272">AbsLineInfo::line</a></div><div class="ttdeci">int line</div><div class="ttdef"><b>Definition</b> lobject.h:888</div></div>
<div class="ttc" id="astructCClosure_html"><div class="ttname"><a href="structCClosure.html">CClosure</a></div><div class="ttdef"><b>Definition</b> lobject.h:1063</div></div>
<div class="ttc" id="astructCClosure_html_a1ba64febc8e6adc43fdbb82583852000"><div class="ttname"><a href="structCClosure.html#a1ba64febc8e6adc43fdbb82583852000">CClosure::f</a></div><div class="ttdeci">lua_CFunction f</div><div class="ttdef"><b>Definition</b> lobject.h:1065</div></div>
<div class="ttc" id="astructCClosure_html_a552c31467816a1fafbd719cf83ff9cba"><div class="ttname"><a href="structCClosure.html#a552c31467816a1fafbd719cf83ff9cba">CClosure::ClosureHeader</a></div><div class="ttdeci">ClosureHeader</div><div class="ttdef"><b>Definition</b> lobject.h:1064</div></div>
<div class="ttc" id="astructCClosure_html_a75d6bfc66f8ed48b3dd67007be84174f"><div class="ttname"><a href="structCClosure.html#a75d6bfc66f8ed48b3dd67007be84174f">CClosure::upvalue</a></div><div class="ttdeci">TValue upvalue[1]</div><div class="ttdef"><b>Definition</b> lobject.h:1066</div></div>
<div class="ttc" id="astructGCObject_html"><div class="ttname"><a href="structGCObject.html">GCObject</a></div><div class="ttdef"><b>Definition</b> lobject.h:468</div></div>
<div class="ttc" id="astructGCObject_html_af27f3b17495ada2a250831a5424ed971"><div class="ttname"><a href="structGCObject.html#af27f3b17495ada2a250831a5424ed971">GCObject::CommonHeader</a></div><div class="ttdeci">CommonHeader</div><div class="ttdef"><b>Definition</b> lobject.h:469</div></div>
<div class="ttc" id="astructLClosure_html"><div class="ttname"><a href="structLClosure.html">LClosure</a></div><div class="ttdef"><b>Definition</b> lobject.h:1075</div></div>
<div class="ttc" id="astructLClosure_html_a4cf173817d3897b0e70822e70d241d6c"><div class="ttname"><a href="structLClosure.html#a4cf173817d3897b0e70822e70d241d6c">LClosure::p</a></div><div class="ttdeci">struct Proto * p</div><div class="ttdef"><b>Definition</b> lobject.h:1077</div></div>
<div class="ttc" id="astructLClosure_html_a6014e6d418f56b1ec866c449cab16044"><div class="ttname"><a href="structLClosure.html#a6014e6d418f56b1ec866c449cab16044">LClosure::ClosureHeader</a></div><div class="ttdeci">ClosureHeader</div><div class="ttdef"><b>Definition</b> lobject.h:1076</div></div>
<div class="ttc" id="astructLClosure_html_a94886e7c7df838f5fab36575b0554682"><div class="ttname"><a href="structLClosure.html#a94886e7c7df838f5fab36575b0554682">LClosure::upvals</a></div><div class="ttdeci">UpVal * upvals[1]</div><div class="ttdef"><b>Definition</b> lobject.h:1078</div></div>
<div class="ttc" id="astructLocVar_html"><div class="ttname"><a href="structLocVar.html">LocVar</a></div><div class="ttdef"><b>Definition</b> lobject.h:867</div></div>
<div class="ttc" id="astructLocVar_html_ac5a8bf5a59430eea070db5b1a97d8b88"><div class="ttname"><a href="structLocVar.html#ac5a8bf5a59430eea070db5b1a97d8b88">LocVar::startpc</a></div><div class="ttdeci">int startpc</div><div class="ttdef"><b>Definition</b> lobject.h:869</div></div>
<div class="ttc" id="astructLocVar_html_acf62684d78349320b90b4acfa3b6d22a"><div class="ttname"><a href="structLocVar.html#acf62684d78349320b90b4acfa3b6d22a">LocVar::varname</a></div><div class="ttdeci">TString * varname</div><div class="ttdef"><b>Definition</b> lobject.h:868</div></div>
<div class="ttc" id="astructLocVar_html_af7f0f7d509579ffec5610e329f85693b"><div class="ttname"><a href="structLocVar.html#af7f0f7d509579ffec5610e329f85693b">LocVar::endpc</a></div><div class="ttdeci">int endpc</div><div class="ttdef"><b>Definition</b> lobject.h:870</div></div>
<div class="ttc" id="astructNode_1_1NodeKey_html"><div class="ttname"><a href="structNode_1_1NodeKey.html">Node::NodeKey</a></div><div class="ttdef"><b>Definition</b> lobject.h:1139</div></div>
<div class="ttc" id="astructNode_1_1NodeKey_html_abac9092163e037bc154ad58f454fbca9"><div class="ttname"><a href="structNode_1_1NodeKey.html#abac9092163e037bc154ad58f454fbca9">Node::NodeKey::key_val</a></div><div class="ttdeci">Value key_val</div><div class="ttdef"><b>Definition</b> lobject.h:1143</div></div>
<div class="ttc" id="astructNode_1_1NodeKey_html_ace566bb6e78ae2d0cdb2a3c6da79cfb6"><div class="ttname"><a href="structNode_1_1NodeKey.html#ace566bb6e78ae2d0cdb2a3c6da79cfb6">Node::NodeKey::next</a></div><div class="ttdeci">int next</div><div class="ttdef"><b>Definition</b> lobject.h:1142</div></div>
<div class="ttc" id="astructNode_1_1NodeKey_html_ad7940273d82fb786627ede300d3e7b46"><div class="ttname"><a href="structNode_1_1NodeKey.html#ad7940273d82fb786627ede300d3e7b46">Node::NodeKey::TValuefields</a></div><div class="ttdeci">TValuefields</div><div class="ttdef"><b>Definition</b> lobject.h:1140</div></div>
<div class="ttc" id="astructNode_1_1NodeKey_html_afdbcc530a117bbf2b90c4f35ad257110"><div class="ttname"><a href="structNode_1_1NodeKey.html#afdbcc530a117bbf2b90c4f35ad257110">Node::NodeKey::key_tt</a></div><div class="ttdeci">lu_byte key_tt</div><div class="ttdef"><b>Definition</b> lobject.h:1141</div></div>
<div class="ttc" id="astructProto_html"><div class="ttname"><a href="structProto.html">Proto</a></div><div class="ttdef"><b>Definition</b> lobject.h:917</div></div>
<div class="ttc" id="astructProto_html_a012268f6cdec514d296b50356decff4e"><div class="ttname"><a href="structProto.html#a012268f6cdec514d296b50356decff4e">Proto::abslineinfo</a></div><div class="ttdeci">AbsLineInfo * abslineinfo</div><div class="ttdef"><b>Definition</b> lobject.h:936</div></div>
<div class="ttc" id="astructProto_html_a028070514796b4accbd99c59e6b83930"><div class="ttname"><a href="structProto.html#a028070514796b4accbd99c59e6b83930">Proto::upvalues</a></div><div class="ttdeci">Upvaldesc * upvalues</div><div class="ttdef"><b>Definition</b> lobject.h:934</div></div>
<div class="ttc" id="astructProto_html_a16d8b2f349f89bdeabda995cf96c1fb0"><div class="ttname"><a href="structProto.html#a16d8b2f349f89bdeabda995cf96c1fb0">Proto::flag</a></div><div class="ttdeci">lu_byte flag</div><div class="ttdef"><b>Definition</b> lobject.h:920</div></div>
<div class="ttc" id="astructProto_html_a3f106f177af6c68ffd8b042713266b98"><div class="ttname"><a href="structProto.html#a3f106f177af6c68ffd8b042713266b98">Proto::numparams</a></div><div class="ttdeci">lu_byte numparams</div><div class="ttdef"><b>Definition</b> lobject.h:919</div></div>
<div class="ttc" id="astructProto_html_a41d627972548e1a6aaf358480ed46f69"><div class="ttname"><a href="structProto.html#a41d627972548e1a6aaf358480ed46f69">Proto::locvars</a></div><div class="ttdeci">LocVar * locvars</div><div class="ttdef"><b>Definition</b> lobject.h:937</div></div>
<div class="ttc" id="astructProto_html_a43e4d3849b5859112d93bdc2534a7cc0"><div class="ttname"><a href="structProto.html#a43e4d3849b5859112d93bdc2534a7cc0">Proto::sizecode</a></div><div class="ttdeci">int sizecode</div><div class="ttdef"><b>Definition</b> lobject.h:924</div></div>
<div class="ttc" id="astructProto_html_a48c289d2c5198fb3bb997196943e9902"><div class="ttname"><a href="structProto.html#a48c289d2c5198fb3bb997196943e9902">Proto::sizeabslineinfo</a></div><div class="ttdeci">int sizeabslineinfo</div><div class="ttdef"><b>Definition</b> lobject.h:928</div></div>
<div class="ttc" id="astructProto_html_a4d8b6a245668e28870027f70a98cce98"><div class="ttname"><a href="structProto.html#a4d8b6a245668e28870027f70a98cce98">Proto::lineinfo</a></div><div class="ttdeci">ls_byte * lineinfo</div><div class="ttdef"><b>Definition</b> lobject.h:935</div></div>
<div class="ttc" id="astructProto_html_a53b66e4e4ac4b612a41b67a0ace9b6a5"><div class="ttname"><a href="structProto.html#a53b66e4e4ac4b612a41b67a0ace9b6a5">Proto::code</a></div><div class="ttdeci">Instruction * code</div><div class="ttdef"><b>Definition</b> lobject.h:932</div></div>
<div class="ttc" id="astructProto_html_a54dc8e2e8973007794fa0ab0e4a71461"><div class="ttname"><a href="structProto.html#a54dc8e2e8973007794fa0ab0e4a71461">Proto::p</a></div><div class="ttdeci">struct Proto ** p</div><div class="ttdef"><b>Definition</b> lobject.h:933</div></div>
<div class="ttc" id="astructProto_html_a5b0bf6a93e383f0a873573b9c99dfb95"><div class="ttname"><a href="structProto.html#a5b0bf6a93e383f0a873573b9c99dfb95">Proto::CommonHeader</a></div><div class="ttdeci">CommonHeader</div><div class="ttdef"><b>Definition</b> lobject.h:918</div></div>
<div class="ttc" id="astructProto_html_a5bd719e0486168f6ecd4b01bf41a7444"><div class="ttname"><a href="structProto.html#a5bd719e0486168f6ecd4b01bf41a7444">Proto::sizek</a></div><div class="ttdeci">int sizek</div><div class="ttdef"><b>Definition</b> lobject.h:923</div></div>
<div class="ttc" id="astructProto_html_a62cf1c61b70bfaa4f1fb839b7398160b"><div class="ttname"><a href="structProto.html#a62cf1c61b70bfaa4f1fb839b7398160b">Proto::linedefined</a></div><div class="ttdeci">int linedefined</div><div class="ttdef"><b>Definition</b> lobject.h:929</div></div>
<div class="ttc" id="astructProto_html_a65303ae1d815313f3358a578113fcc6e"><div class="ttname"><a href="structProto.html#a65303ae1d815313f3358a578113fcc6e">Proto::sizelineinfo</a></div><div class="ttdeci">int sizelineinfo</div><div class="ttdef"><b>Definition</b> lobject.h:925</div></div>
<div class="ttc" id="astructProto_html_a6ecec897497ba7d94df6ef69289ef5c0"><div class="ttname"><a href="structProto.html#a6ecec897497ba7d94df6ef69289ef5c0">Proto::sizeupvalues</a></div><div class="ttdeci">int sizeupvalues</div><div class="ttdef"><b>Definition</b> lobject.h:922</div></div>
<div class="ttc" id="astructProto_html_a73ddad1a18b7c46be46ec32aa2a08632"><div class="ttname"><a href="structProto.html#a73ddad1a18b7c46be46ec32aa2a08632">Proto::sizep</a></div><div class="ttdeci">int sizep</div><div class="ttdef"><b>Definition</b> lobject.h:926</div></div>
<div class="ttc" id="astructProto_html_a7991ec396b493a42b5c7f38b4e162959"><div class="ttname"><a href="structProto.html#a7991ec396b493a42b5c7f38b4e162959">Proto::gclist</a></div><div class="ttdeci">GCObject * gclist</div><div class="ttdef"><b>Definition</b> lobject.h:939</div></div>
<div class="ttc" id="astructProto_html_a92b6ec319e7aa1ee8b8ff7807353ad96"><div class="ttname"><a href="structProto.html#a92b6ec319e7aa1ee8b8ff7807353ad96">Proto::source</a></div><div class="ttdeci">TString * source</div><div class="ttdef"><b>Definition</b> lobject.h:938</div></div>
<div class="ttc" id="astructProto_html_a9c9ed4e9d996233f75cdf56b912e4803"><div class="ttname"><a href="structProto.html#a9c9ed4e9d996233f75cdf56b912e4803">Proto::maxstacksize</a></div><div class="ttdeci">lu_byte maxstacksize</div><div class="ttdef"><b>Definition</b> lobject.h:921</div></div>
<div class="ttc" id="astructProto_html_a9ef7fae1b22b11f5a145cfee8150059c"><div class="ttname"><a href="structProto.html#a9ef7fae1b22b11f5a145cfee8150059c">Proto::lastlinedefined</a></div><div class="ttdeci">int lastlinedefined</div><div class="ttdef"><b>Definition</b> lobject.h:930</div></div>
<div class="ttc" id="astructProto_html_ac2ab37e941e8866687f44f7b2f4b95a9"><div class="ttname"><a href="structProto.html#ac2ab37e941e8866687f44f7b2f4b95a9">Proto::sizelocvars</a></div><div class="ttdeci">int sizelocvars</div><div class="ttdef"><b>Definition</b> lobject.h:927</div></div>
<div class="ttc" id="astructProto_html_ae292fb0c0558679704933824ce96eac2"><div class="ttname"><a href="structProto.html#ae292fb0c0558679704933824ce96eac2">Proto::k</a></div><div class="ttdeci">TValue * k</div><div class="ttdef"><b>Definition</b> lobject.h:931</div></div>
<div class="ttc" id="astructTString_html"><div class="ttname"><a href="structTString.html">TString</a></div><div class="ttdef"><b>Definition</b> lobject.h:644</div></div>
<div class="ttc" id="astructTString_html_a11878b0fae7367ad203a0c470ee54fa1"><div class="ttname"><a href="structTString.html#a11878b0fae7367ad203a0c470ee54fa1">TString::extra</a></div><div class="ttdeci">lu_byte extra</div><div class="ttdef"><b>Definition</b> lobject.h:646</div></div>
<div class="ttc" id="astructTString_html_a25f3ee23e67e10eba379fa4f31dec5d2"><div class="ttname"><a href="structTString.html#a25f3ee23e67e10eba379fa4f31dec5d2">TString::lnglen</a></div><div class="ttdeci">size_t lnglen</div><div class="ttdef"><b>Definition</b> lobject.h:651</div></div>
<div class="ttc" id="astructTString_html_a46677057221656f98fa80eb77089de45"><div class="ttname"><a href="structTString.html#a46677057221656f98fa80eb77089de45">TString::CommonHeader</a></div><div class="ttdeci">CommonHeader</div><div class="ttdef"><b>Definition</b> lobject.h:645</div></div>
<div class="ttc" id="astructTString_html_a4754301957abb501d3525ed5796611d6"><div class="ttname"><a href="structTString.html#a4754301957abb501d3525ed5796611d6">TString::ud</a></div><div class="ttdeci">void * ud</div><div class="ttdef"><b>Definition</b> lobject.h:656</div></div>
<div class="ttc" id="astructTString_html_a4daff60502f0255ec75513191424a9c7"><div class="ttname"><a href="structTString.html#a4daff60502f0255ec75513191424a9c7">TString::shrlen</a></div><div class="ttdeci">ls_byte shrlen</div><div class="ttdef"><b>Definition</b> lobject.h:647</div></div>
<div class="ttc" id="astructTString_html_a57f69ac2b4c4eb34f5521ffd68d90b5f"><div class="ttname"><a href="structTString.html#a57f69ac2b4c4eb34f5521ffd68d90b5f">TString::hash</a></div><div class="ttdeci">unsigned int hash</div><div class="ttdef"><b>Definition</b> lobject.h:648</div></div>
<div class="ttc" id="astructTString_html_ab794bd2b18ab7a16fa3f3b16669801d7"><div class="ttname"><a href="structTString.html#ab794bd2b18ab7a16fa3f3b16669801d7">TString::contents</a></div><div class="ttdeci">char * contents</div><div class="ttdef"><b>Definition</b> lobject.h:654</div></div>
<div class="ttc" id="astructTString_html_acad92742e5915e44fdbbeed12b3c244d"><div class="ttname"><a href="structTString.html#acad92742e5915e44fdbbeed12b3c244d">TString::falloc</a></div><div class="ttdeci">lua_Alloc falloc</div><div class="ttdef"><b>Definition</b> lobject.h:655</div></div>
<div class="ttc" id="astructTString_html_ada0c4b3ed24fc7a9f778259c7475e276"><div class="ttname"><a href="structTString.html#ada0c4b3ed24fc7a9f778259c7475e276">TString::u</a></div><div class="ttdeci">union TString::@320234166135014164036060243241335357240065114130 u</div></div>
<div class="ttc" id="astructTString_html_adb99ad67b6bc67f62fac7d69b88f07fd"><div class="ttname"><a href="structTString.html#adb99ad67b6bc67f62fac7d69b88f07fd">TString::hnext</a></div><div class="ttdeci">struct TString * hnext</div><div class="ttdef"><b>Definition</b> lobject.h:652</div></div>
<div class="ttc" id="astructTValue_html"><div class="ttname"><a href="structTValue.html">TValue</a></div><div class="ttdef"><b>Definition</b> lobject.h:132</div></div>
<div class="ttc" id="astructTValue_html_ab8256d9daa6c5ba0d03dcfcf997357f7"><div class="ttname"><a href="structTValue.html#ab8256d9daa6c5ba0d03dcfcf997357f7">TValue::TValuefields</a></div><div class="ttdeci">TValuefields</div><div class="ttdef"><b>Definition</b> lobject.h:133</div></div>
<div class="ttc" id="astructTable_html"><div class="ttname"><a href="structTable.html">Table</a></div><div class="ttdef"><b>Definition</b> lobject.h:1181</div></div>
<div class="ttc" id="astructTable_html_a1b6f3d76efed2011a36ee7c78f65aa70"><div class="ttname"><a href="structTable.html#a1b6f3d76efed2011a36ee7c78f65aa70">Table::gclist</a></div><div class="ttdeci">GCObject * gclist</div><div class="ttdef"><b>Definition</b> lobject.h:1189</div></div>
<div class="ttc" id="astructTable_html_a519f179c707cb4e93bb66d09151c89e5"><div class="ttname"><a href="structTable.html#a519f179c707cb4e93bb66d09151c89e5">Table::node</a></div><div class="ttdeci">Node * node</div><div class="ttdef"><b>Definition</b> lobject.h:1187</div></div>
<div class="ttc" id="astructTable_html_a643cf38ebbab9e5af99ff8a980ffbae5"><div class="ttname"><a href="structTable.html#a643cf38ebbab9e5af99ff8a980ffbae5">Table::flags</a></div><div class="ttdeci">lu_byte flags</div><div class="ttdef"><b>Definition</b> lobject.h:1183</div></div>
<div class="ttc" id="astructTable_html_a99c20fa696fb6a4e89890efa3819ebdc"><div class="ttname"><a href="structTable.html#a99c20fa696fb6a4e89890efa3819ebdc">Table::metatable</a></div><div class="ttdeci">struct Table * metatable</div><div class="ttdef"><b>Definition</b> lobject.h:1188</div></div>
<div class="ttc" id="astructTable_html_ab4290d33cf4cc8c47868f8640300970a"><div class="ttname"><a href="structTable.html#ab4290d33cf4cc8c47868f8640300970a">Table::asize</a></div><div class="ttdeci">unsigned int asize</div><div class="ttdef"><b>Definition</b> lobject.h:1185</div></div>
<div class="ttc" id="astructTable_html_ad22ad0fad7ad6116de3dcc89fba94747"><div class="ttname"><a href="structTable.html#ad22ad0fad7ad6116de3dcc89fba94747">Table::array</a></div><div class="ttdeci">Value * array</div><div class="ttdef"><b>Definition</b> lobject.h:1186</div></div>
<div class="ttc" id="astructTable_html_aeceeffe77c9ef26aeca656183fc50110"><div class="ttname"><a href="structTable.html#aeceeffe77c9ef26aeca656183fc50110">Table::CommonHeader</a></div><div class="ttdeci">CommonHeader</div><div class="ttdef"><b>Definition</b> lobject.h:1182</div></div>
<div class="ttc" id="astructTable_html_aed057d880ebe0f38f65e626f646adf6a"><div class="ttname"><a href="structTable.html#aed057d880ebe0f38f65e626f646adf6a">Table::lsizenode</a></div><div class="ttdeci">lu_byte lsizenode</div><div class="ttdef"><b>Definition</b> lobject.h:1184</div></div>
<div class="ttc" id="astructUdata0_html"><div class="ttname"><a href="structUdata0.html">Udata0</a></div><div class="ttdef"><b>Definition</b> lobject.h:793</div></div>
<div class="ttc" id="astructUdata0_html_a0931d5764b287f7d4f6e2a0b3fdd46f7"><div class="ttname"><a href="structUdata0.html#a0931d5764b287f7d4f6e2a0b3fdd46f7">Udata0::LUAI_MAXALIGN</a></div><div class="ttdeci">LUAI_MAXALIGN</div><div class="ttdef"><b>Definition</b> lobject.h:800</div></div>
<div class="ttc" id="astructUdata0_html_a1a561b22c16bc76f669e976afee7d386"><div class="ttname"><a href="structUdata0.html#a1a561b22c16bc76f669e976afee7d386">Udata0::bindata</a></div><div class="ttdeci">union Udata0::@331026231271350167072072171044004363352141370313 bindata</div></div>
<div class="ttc" id="astructUdata0_html_a46a84ae455cc55d4c8379ff4480b9e4f"><div class="ttname"><a href="structUdata0.html#a46a84ae455cc55d4c8379ff4480b9e4f">Udata0::nuvalue</a></div><div class="ttdeci">unsigned short nuvalue</div><div class="ttdef"><b>Definition</b> lobject.h:795</div></div>
<div class="ttc" id="astructUdata0_html_ac6c257c24240939a6026e1c2bb755502"><div class="ttname"><a href="structUdata0.html#ac6c257c24240939a6026e1c2bb755502">Udata0::CommonHeader</a></div><div class="ttdeci">CommonHeader</div><div class="ttdef"><b>Definition</b> lobject.h:794</div></div>
<div class="ttc" id="astructUdata0_html_af08d0105d68e5babd31e76745c5aa1e9"><div class="ttname"><a href="structUdata0.html#af08d0105d68e5babd31e76745c5aa1e9">Udata0::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition</b> lobject.h:796</div></div>
<div class="ttc" id="astructUdata0_html_af7639961b49bdd3c3f3e695c2f035b24"><div class="ttname"><a href="structUdata0.html#af7639961b49bdd3c3f3e695c2f035b24">Udata0::metatable</a></div><div class="ttdeci">struct Table * metatable</div><div class="ttdef"><b>Definition</b> lobject.h:797</div></div>
<div class="ttc" id="astructUdata_html"><div class="ttname"><a href="structUdata.html">Udata</a></div><div class="ttdef"><b>Definition</b> lobject.h:772</div></div>
<div class="ttc" id="astructUdata_html_a39f828bdcf3f046e285ffbecfcaea56b"><div class="ttname"><a href="structUdata.html#a39f828bdcf3f046e285ffbecfcaea56b">Udata::metatable</a></div><div class="ttdeci">struct Table * metatable</div><div class="ttdef"><b>Definition</b> lobject.h:776</div></div>
<div class="ttc" id="astructUdata_html_a676537b4656a8bdcf2e61f88ed5f6848"><div class="ttname"><a href="structUdata.html#a676537b4656a8bdcf2e61f88ed5f6848">Udata::nuvalue</a></div><div class="ttdeci">unsigned short nuvalue</div><div class="ttdef"><b>Definition</b> lobject.h:774</div></div>
<div class="ttc" id="astructUdata_html_aaa6ffd32850e8506f6fa4c441702d374"><div class="ttname"><a href="structUdata.html#aaa6ffd32850e8506f6fa4c441702d374">Udata::CommonHeader</a></div><div class="ttdeci">CommonHeader</div><div class="ttdef"><b>Definition</b> lobject.h:773</div></div>
<div class="ttc" id="astructUdata_html_abc467c0c1ec8511376150eb728514dc5"><div class="ttname"><a href="structUdata.html#abc467c0c1ec8511376150eb728514dc5">Udata::len</a></div><div class="ttdeci">size_t len</div><div class="ttdef"><b>Definition</b> lobject.h:775</div></div>
<div class="ttc" id="astructUdata_html_abfc560a8436c8a9c238b175706beab7b"><div class="ttname"><a href="structUdata.html#abfc560a8436c8a9c238b175706beab7b">Udata::uv</a></div><div class="ttdeci">UValue uv[1]</div><div class="ttdef"><b>Definition</b> lobject.h:778</div></div>
<div class="ttc" id="astructUdata_html_af984abb747b485c84ea97362d843d897"><div class="ttname"><a href="structUdata.html#af984abb747b485c84ea97362d843d897">Udata::gclist</a></div><div class="ttdeci">GCObject * gclist</div><div class="ttdef"><b>Definition</b> lobject.h:777</div></div>
<div class="ttc" id="astructUpVal_html"><div class="ttname"><a href="structUpVal.html">UpVal</a></div><div class="ttdef"><b>Definition</b> lobject.h:1029</div></div>
<div class="ttc" id="astructUpVal_html_a1f7fa9c8703aad994bd21edad8b0c027"><div class="ttname"><a href="structUpVal.html#a1f7fa9c8703aad994bd21edad8b0c027">UpVal::open</a></div><div class="ttdeci">struct UpVal::@222214355277211362135242071013042147175011244075::@055071243343024052064365115311264360007105122370 open</div></div>
<div class="ttc" id="astructUpVal_html_a3e874535cf761992620ec6b3a1ddedd7"><div class="ttname"><a href="structUpVal.html#a3e874535cf761992620ec6b3a1ddedd7">UpVal::u</a></div><div class="ttdeci">union UpVal::@222214355277211362135242071013042147175011244075 u</div></div>
<div class="ttc" id="astructUpVal_html_a4e31d0a4bda814a7173a9ef5ca88ba3c"><div class="ttname"><a href="structUpVal.html#a4e31d0a4bda814a7173a9ef5ca88ba3c">UpVal::CommonHeader</a></div><div class="ttdeci">CommonHeader</div><div class="ttdef"><b>Definition</b> lobject.h:1030</div></div>
<div class="ttc" id="astructUpVal_html_a5181153fb4139bfe1246bfff44700216"><div class="ttname"><a href="structUpVal.html#a5181153fb4139bfe1246bfff44700216">UpVal::offset</a></div><div class="ttdeci">ptrdiff_t offset</div><div class="ttdef"><b>Definition</b> lobject.h:1034</div></div>
<div class="ttc" id="astructUpVal_html_a8e9dff354074323b0df2bd0795b6e9d3"><div class="ttname"><a href="structUpVal.html#a8e9dff354074323b0df2bd0795b6e9d3">UpVal::p</a></div><div class="ttdeci">TValue * p</div><div class="ttdef"><b>Definition</b> lobject.h:1033</div></div>
<div class="ttc" id="astructUpVal_html_abc22d06bbcaf3f197af9c6069c562505"><div class="ttname"><a href="structUpVal.html#abc22d06bbcaf3f197af9c6069c562505">UpVal::value</a></div><div class="ttdeci">TValue value</div><div class="ttdef"><b>Definition</b> lobject.h:1043</div></div>
<div class="ttc" id="astructUpVal_html_ad60d3e0af32d663d3cde2e033bbdefd8"><div class="ttname"><a href="structUpVal.html#ad60d3e0af32d663d3cde2e033bbdefd8">UpVal::next</a></div><div class="ttdeci">struct UpVal * next</div><div class="ttdef"><b>Definition</b> lobject.h:1040</div></div>
<div class="ttc" id="astructUpVal_html_ae884e7120e776fd0699a9bdc02403480"><div class="ttname"><a href="structUpVal.html#ae884e7120e776fd0699a9bdc02403480">UpVal::v</a></div><div class="ttdeci">union UpVal::@007137107371223303126144073105072175241014175305 v</div></div>
<div class="ttc" id="astructUpVal_html_af88c50a2df90e5e84a6abedde641771a"><div class="ttname"><a href="structUpVal.html#af88c50a2df90e5e84a6abedde641771a">UpVal::previous</a></div><div class="ttdeci">struct UpVal ** previous</div><div class="ttdef"><b>Definition</b> lobject.h:1041</div></div>
<div class="ttc" id="astructUpvaldesc_html"><div class="ttname"><a href="structUpvaldesc.html">Upvaldesc</a></div><div class="ttdef"><b>Definition</b> lobject.h:852</div></div>
<div class="ttc" id="astructUpvaldesc_html_a1315fb98c5f398c3f3323967cb9ec7ba"><div class="ttname"><a href="structUpvaldesc.html#a1315fb98c5f398c3f3323967cb9ec7ba">Upvaldesc::kind</a></div><div class="ttdeci">lu_byte kind</div><div class="ttdef"><b>Definition</b> lobject.h:856</div></div>
<div class="ttc" id="astructUpvaldesc_html_a1e5182ac7b8b72848ed71b7b4844e3d1"><div class="ttname"><a href="structUpvaldesc.html#a1e5182ac7b8b72848ed71b7b4844e3d1">Upvaldesc::instack</a></div><div class="ttdeci">lu_byte instack</div><div class="ttdef"><b>Definition</b> lobject.h:854</div></div>
<div class="ttc" id="astructUpvaldesc_html_a8478ecca9cb593200c562a0837aedfac"><div class="ttname"><a href="structUpvaldesc.html#a8478ecca9cb593200c562a0837aedfac">Upvaldesc::idx</a></div><div class="ttdeci">lu_byte idx</div><div class="ttdef"><b>Definition</b> lobject.h:855</div></div>
<div class="ttc" id="astructUpvaldesc_html_a8870289fbc6611275d093ef1c08cf9ed"><div class="ttname"><a href="structUpvaldesc.html#a8870289fbc6611275d093ef1c08cf9ed">Upvaldesc::name</a></div><div class="ttdeci">TString * name</div><div class="ttdef"><b>Definition</b> lobject.h:853</div></div>
<div class="ttc" id="astructlua__State_html"><div class="ttname"><a href="structlua__State.html">lua_State</a></div><div class="ttdef"><b>Definition</b> lstate.h:285</div></div>
<div class="ttc" id="aunionClosure_html"><div class="ttname"><a href="unionClosure.html">Closure</a></div><div class="ttdef"><b>Definition</b> lobject.h:1087</div></div>
<div class="ttc" id="aunionClosure_html_a8c338ec7dc76078cbee5887857de713c"><div class="ttname"><a href="unionClosure.html#a8c338ec7dc76078cbee5887857de713c">Closure::l</a></div><div class="ttdeci">LClosure l</div><div class="ttdef"><b>Definition</b> lobject.h:1089</div></div>
<div class="ttc" id="aunionClosure_html_ace9dac5a62b61db682ef0cd86b3b44b1"><div class="ttname"><a href="unionClosure.html#ace9dac5a62b61db682ef0cd86b3b44b1">Closure::c</a></div><div class="ttdeci">CClosure c</div><div class="ttdef"><b>Definition</b> lobject.h:1088</div></div>
<div class="ttc" id="aunionNode_html"><div class="ttname"><a href="unionNode.html">Node</a></div><div class="ttdef"><b>Definition</b> lobject.h:1137</div></div>
<div class="ttc" id="aunionNode_html_a79460c331faee0ef988637e92749e866"><div class="ttname"><a href="unionNode.html#a79460c331faee0ef988637e92749e866">Node::i_val</a></div><div class="ttdeci">TValue i_val</div><div class="ttdef"><b>Definition</b> lobject.h:1145</div></div>
<div class="ttc" id="aunionNode_html_a8f1edb039f176596b777da8f537c1071"><div class="ttname"><a href="unionNode.html#a8f1edb039f176596b777da8f537c1071">Node::u</a></div><div class="ttdeci">struct Node::NodeKey u</div></div>
<div class="ttc" id="aunionStackValue_html"><div class="ttname"><a href="unionStackValue.html">StackValue</a></div><div class="ttdef"><b>Definition</b> lobject.h:261</div></div>
<div class="ttc" id="aunionStackValue_html_a26033019ebf5144b31ae1c442c539cd4"><div class="ttname"><a href="unionStackValue.html#a26033019ebf5144b31ae1c442c539cd4">StackValue::TValuefields</a></div><div class="ttdeci">TValuefields</div><div class="ttdef"><b>Definition</b> lobject.h:265</div></div>
<div class="ttc" id="aunionStackValue_html_a7771cd1552c09ee6ed38b626b2159c14"><div class="ttname"><a href="unionStackValue.html#a7771cd1552c09ee6ed38b626b2159c14">StackValue::delta</a></div><div class="ttdeci">unsigned short delta</div><div class="ttdef"><b>Definition</b> lobject.h:266</div></div>
<div class="ttc" id="aunionStackValue_html_a8427f32076f2a9ad8db716da1deeb468"><div class="ttname"><a href="unionStackValue.html#a8427f32076f2a9ad8db716da1deeb468">StackValue::val</a></div><div class="ttdeci">TValue val</div><div class="ttdef"><b>Definition</b> lobject.h:262</div></div>
<div class="ttc" id="aunionStackValue_html_a9a0057a5ab930ec0bb2ad624f6c5e4ca"><div class="ttname"><a href="unionStackValue.html#a9a0057a5ab930ec0bb2ad624f6c5e4ca">StackValue::tbclist</a></div><div class="ttdeci">struct StackValue::@102232031171147227212106263041131350124072376312 tbclist</div></div>
<div class="ttc" id="aunionStkIdRel_html"><div class="ttname"><a href="unionStkIdRel.html">StkIdRel</a></div><div class="ttdef"><b>Definition</b> lobject.h:289</div></div>
<div class="ttc" id="aunionStkIdRel_html_a217d7edba31898cdfe8fdd91df893d26"><div class="ttname"><a href="unionStkIdRel.html#a217d7edba31898cdfe8fdd91df893d26">StkIdRel::p</a></div><div class="ttdeci">StkId p</div><div class="ttdef"><b>Definition</b> lobject.h:290</div></div>
<div class="ttc" id="aunionStkIdRel_html_aa5b9278d862af81303c5ce9f9b62943b"><div class="ttname"><a href="unionStkIdRel.html#aa5b9278d862af81303c5ce9f9b62943b">StkIdRel::offset</a></div><div class="ttdeci">ptrdiff_t offset</div><div class="ttdef"><b>Definition</b> lobject.h:291</div></div>
<div class="ttc" id="aunionUValue_html"><div class="ttname"><a href="unionUValue.html">UValue</a></div><div class="ttdef"><b>Definition</b> lobject.h:756</div></div>
<div class="ttc" id="aunionUValue_html_a3257500ea5d9b5b592f1ff8f31f1dda3"><div class="ttname"><a href="unionUValue.html#a3257500ea5d9b5b592f1ff8f31f1dda3">UValue::LUAI_MAXALIGN</a></div><div class="ttdeci">LUAI_MAXALIGN</div><div class="ttdef"><b>Definition</b> lobject.h:758</div></div>
<div class="ttc" id="aunionUValue_html_afaa156bae31b8f21eb9743c2a757ce89"><div class="ttname"><a href="unionUValue.html#afaa156bae31b8f21eb9743c2a757ce89">UValue::uv</a></div><div class="ttdeci">TValue uv</div><div class="ttdef"><b>Definition</b> lobject.h:757</div></div>
<div class="ttc" id="aunionValue_html"><div class="ttname"><a href="unionValue.html">Value</a></div><div class="ttdef"><b>Definition</b> lobject.h:98</div></div>
<div class="ttc" id="aunionValue_html_a0d6f6bd1f2576b712e95aaffa0f87bab"><div class="ttname"><a href="unionValue.html#a0d6f6bd1f2576b712e95aaffa0f87bab">Value::i</a></div><div class="ttdeci">lua_Integer i</div><div class="ttdef"><b>Definition</b> lobject.h:102</div></div>
<div class="ttc" id="aunionValue_html_a1809643a2deb85a2e8d690b8e1488481"><div class="ttname"><a href="unionValue.html#a1809643a2deb85a2e8d690b8e1488481">Value::gc</a></div><div class="ttdeci">struct GCObject * gc</div><div class="ttdef"><b>Definition</b> lobject.h:99</div></div>
<div class="ttc" id="aunionValue_html_aa001f39a25c7d85a27cbdbab2d386ccd"><div class="ttname"><a href="unionValue.html#aa001f39a25c7d85a27cbdbab2d386ccd">Value::p</a></div><div class="ttdeci">void * p</div><div class="ttdef"><b>Definition</b> lobject.h:100</div></div>
<div class="ttc" id="aunionValue_html_aa6fc4345b43257a82c278a07adcf59dc"><div class="ttname"><a href="unionValue.html#aa6fc4345b43257a82c278a07adcf59dc">Value::ub</a></div><div class="ttdeci">lu_byte ub</div><div class="ttdef"><b>Definition</b> lobject.h:105</div></div>
<div class="ttc" id="aunionValue_html_acc94eaa63b3acf650541fcd09025f2ad"><div class="ttname"><a href="unionValue.html#acc94eaa63b3acf650541fcd09025f2ad">Value::f</a></div><div class="ttdeci">lua_CFunction f</div><div class="ttdef"><b>Definition</b> lobject.h:101</div></div>
<div class="ttc" id="aunionValue_html_ae8663f45c016d5fbf827cb308b2f3df8"><div class="ttname"><a href="unionValue.html#ae8663f45c016d5fbf827cb308b2f3df8">Value::n</a></div><div class="ttdeci">lua_Number n</div><div class="ttdef"><b>Definition</b> lobject.h:103</div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="lobject_8h.html">lobject.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
